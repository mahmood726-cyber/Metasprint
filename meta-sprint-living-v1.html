<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>META-SPRINT LIVING V1.0</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8FAFC;
            --surface: #FFFFFF;
            --border: #E2E8F0;
            --border-strong: #CBD5E1;
            --text: #0F172A;
            --text-secondary: #475569;
            --text-muted: #64748B;
            --accent: #10B981;
            --accent-light: #ECFDF5;
            --success: #059669;
            --success-light: #D1FAE5;
            --warning: #D97706;
            --warning-light: #FEF3C7;
            --danger: #DC2626;
            --danger-light: #FEE2E2;
            --purple: #7C3AED;
            --purple-light: #EDE9FE;
            --living: #10B981;
            --living-light: #ECFDF5;
            --warning-bg: #FFFBEB;
            --warning-border: #F59E0B;
            --warning-title: #B45309;
            --warning-text: #92400E;
        }
        .dark-mode {
            --bg: #0F172A;
            --surface: #1E293B;
            --border: #334155;
            --border-strong: #475569;
            --text: #F1F5F9;
            --text-secondary: #CBD5E1;
            --text-muted: #94A3B8;
            --accent: #34D399;
            --accent-light: #065F46;
            --success: #10B981;
            --success-light: #032E23;
            --warning: #F59E0B;
            --warning-light: #4A2008;
            --danger: #EF4444;
            --danger-light: #451A1A;
            --purple: #A78BFA;
            --purple-light: #2E1065;
            --living: #34D399;
            --living-light: #065F46;
            --warning-bg: #422006;
            --warning-border: #92400E;
            --warning-title: #FBBF24;
            --warning-text: #FDE68A;
        }
        .dark-mode .form-input, .dark-mode .form-textarea, .dark-mode select { background: var(--surface); color: var(--text); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'IBM Plex Sans', -apple-system, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; font-size: 14px; }
        .container { max-width: 900px; margin: 0 auto; padding: 16px; }
        .header { background: linear-gradient(135deg, var(--living) 0%, #047857 100%); border-bottom: 1px solid var(--border); padding: 12px 16px; position: sticky; top: 0; z-index: 100; }
        .header-inner { max-width: 900px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap; }
        .logo { font-weight: 700; font-size: 18px; color: white; }
        .logo span { color: rgba(255,255,255,0.7); font-weight: 400; font-size: 12px; }
        .logo .living-badge { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px; }
        .header-controls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .role-badge { background: rgba(255,255,255,0.2); color: white; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; cursor: pointer; }
        .day-control { display: flex; align-items: center; gap: 8px; }
        .day-btn { width: 44px; height: 44px; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; background: rgba(255,255,255,0.1); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .day-btn:hover:not(:disabled) { background: rgba(255,255,255,0.2); }
        .day-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .day-display { font-weight: 700; font-size: 16px; min-width: 70px; text-align: center; color: white; cursor: pointer; padding: 4px 8px; border-radius: 6px; }
        .day-display:hover { background: rgba(255,255,255,0.1); }
        .day-hint { font-size: 12px; color: rgba(255,255,255,0.7); text-align: center; margin-top: 2px; }
        .toast { position: fixed; bottom: 24px; right: 24px; background: var(--success); color: white; padding: 12px 20px; border-radius: 8px; font-weight: 500; font-size: 13px; z-index: 1000; opacity: 0; transform: translateY(20px); transition: all 0.3s ease; pointer-events: none; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .toast.visible { opacity: 1; transform: translateY(0); }
        .toast.error { background: var(--danger); }
        .tabs { display: flex; gap: 4px; background: var(--surface); padding: 8px 16px; border-bottom: 1px solid var(--border); overflow-x: auto; }
        .tab { padding: 12px 16px; border: none; background: none; font-family: inherit; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: 6px; white-space: nowrap; position: relative; }
        .tab:hover { background: var(--bg); }
        .tab.active { background: var(--living-light); color: var(--living); }
        .tab-badge { position: absolute; top: 2px; right: 2px; width: 8px; height: 8px; border-radius: 50%; }
        .tab-badge.needs-attention { background: var(--warning); }
        .tab-badge.complete { background: var(--success); }
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 16px; overflow: hidden; }
        .card-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 12px; }
        .card-title { font-weight: 600; font-size: 15px; }
        .card-body { padding: 16px; }
        .living-indicator { background: var(--living-light); color: var(--living); padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .phase-badge { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .phase-a { background: var(--purple-light); color: var(--purple); }
        .phase-b { background: var(--living-light); color: var(--living); }
        .phase-c { background: var(--warning-light); color: var(--warning); }
        .phase-d { background: var(--success-light); color: var(--success); }
        .phase-e { background: var(--danger-light); color: var(--danger); }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 16px; display: flex; align-items: flex-start; gap: 12px; }
        .alert-icon { font-size: 18px; flex-shrink: 0; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: 600; margin-bottom: 2px; }
        .alert-text { font-size: 13px; }
        .alert-info { background: var(--living-light); border: 1px solid var(--living); }
        .alert-warning { background: var(--warning-light); border: 1px solid var(--warning); }
        .alert-danger { background: var(--danger-light); border: 1px solid var(--danger); }
        .alert-success { background: var(--success-light); border: 1px solid var(--success); }
        .checklist-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
        .checklist-item:hover { background: var(--bg); }
        .checklist-item.checked { background: var(--success-light); border-color: var(--success); }
        .check-box { width: 20px; height: 20px; border: 2px solid var(--border-strong); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
        .checklist-item.checked .check-box { background: var(--success); border-color: var(--success); }
        .check-box svg { color: white; display: none; }
        .checklist-item.checked .check-box svg { display: block; }
        .checklist-content { flex: 1; }
        .checklist-title { font-weight: 500; }
        .checklist-hint { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
        .timeline-bar { height: 8px; background: var(--border); border-radius: 4px; position: relative; margin: 16px 0; }
        .timeline-fill { height: 100%; background: var(--living); border-radius: 4px; transition: width 0.3s; }
        .timeline-markers { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted); margin-top: 4px; }
        .timeline-marker { text-align: center; }
        .timeline-marker.active { color: var(--living); font-weight: 600; }
        .timeline-marker.passed { color: var(--success); }
        .health-dashboard { background: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%); border: 2px solid var(--living); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .health-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
        .health-title { font-weight: 700; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .health-score { font-size: 24px; font-weight: 700; }
        .health-score.good { color: var(--success); }
        .health-score.warning { color: var(--warning); }
        .health-score.danger { color: var(--danger); }
        .health-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; }
        .health-stat { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
        .health-stat-value { font-size: 20px; font-weight: 700; color: var(--living); }
        .health-stat-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
        .gate-dots { display: flex; gap: 6px; justify-content: center; margin-top: 12px; }
        .gate-dot { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: var(--text-muted); }
        .gate-dot.passed { background: var(--success); border-color: var(--success); color: white; }
        .gate-dot.current { border-color: var(--warning); color: var(--warning); animation: pulse 1.5s infinite; }

        .risk-panel { margin-top: 12px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px; }
        .risk-header { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 8px; }
        .risk-title { font-size: 12px; font-weight: 600; color: var(--text-secondary); letter-spacing: 0.02em; text-transform: uppercase; }
        .risk-badge { font-size: 11px; font-weight: 700; padding: 2px 8px; border-radius: 999px; }
        .risk-badge.low { background: var(--success-light); color: var(--success); }
        .risk-badge.medium { background: var(--warning-light); color: var(--warning); }
        .risk-badge.high { background: var(--danger-light); color: var(--danger); }
        .risk-list { list-style: none; margin: 0; padding: 0; display: grid; gap: 6px; }
        .risk-item { font-size: 12px; color: var(--text-secondary); padding: 6px 8px; border-radius: 6px; background: var(--bg); border: 1px solid var(--border); }
        .risk-item.medium { border-color: var(--warning); background: var(--warning-light); color: var(--warning); }
        .risk-item.high { border-color: var(--danger); background: var(--danger-light); color: var(--danger); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .form-row { margin-bottom: 12px; }
        .form-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; display: block; }
        .form-input, .form-textarea { width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; font-family: inherit; font-size: 13px; }
        .form-textarea { resize: vertical; min-height: 60px; }
        .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
        .copy-btn { background: var(--living); color: white; border: none; padding: 10px 20px; border-radius: 6px; font-family: inherit; font-weight: 600; cursor: pointer; }
        .copy-btn:hover { background: #047857; }
        .download-btn { background: var(--surface); color: var(--text); border: 1px solid var(--border); padding: 10px 20px; border-radius: 6px; font-family: inherit; font-weight: 600; cursor: pointer; }
        .download-btn:hover { background: var(--bg); }
        .btn-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
        .template-card { border: 1px solid var(--border); border-radius: 8px; margin-bottom: 12px; overflow: hidden; }
        .template-header { padding: 12px 16px; background: var(--bg); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .template-header:hover { background: var(--border); }
        .template-name { font-weight: 600; display: flex; align-items: center; gap: 8px; }
        .template-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .badge-essential { background: var(--danger-light); color: var(--danger); }
        .badge-living { background: var(--living-light); color: var(--living); }
        .badge-reference { background: var(--purple-light); color: var(--purple); }
        .template-body { padding: 16px; display: none; }
        .template-body.open { display: block; }
        .template-output { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-top: 12px; font-family: 'IBM Plex Mono', monospace; font-size: 12px; white-space: pre-wrap; display: none; }
        .template-output.visible { display: block; }
        .ref-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .ref-table th, .ref-table td { padding: 10px 12px; border: 1px solid var(--border); text-align: left; }
        .ref-table th { background: var(--bg); font-weight: 600; }
        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 16px; }
        .modal.visible { display: flex; }
        .modal-card { background: var(--surface); border-radius: 16px; width: 100%; max-width: 550px; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-title { font-weight: 700; font-size: 18px; }
        .modal-close { width: 44px; height: 44px; border: none; background: var(--bg); border-radius: 8px; cursor: pointer; font-size: 22px; display: flex; align-items: center; justify-content: center; }
        .modal-body { padding: 24px; }
        .onboarding { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.85); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 16px; overflow-y: auto; }
        .onboarding.hidden { display: none; }
        .onboarding-card { background: var(--surface); border-radius: 16px; width: 100%; max-width: 520px; max-height: 90vh; overflow-y: auto; }
        .onboarding-header { background: linear-gradient(135deg, var(--living) 0%, #047857 100%); padding: 24px; border-radius: 16px 16px 0 0; color: white; text-align: center; }
        .onboarding-body { padding: 24px; }
        .role-grid { display: grid; gap: 8px; margin-bottom: 24px; }
        .role-btn { display: flex; align-items: center; gap: 12px; padding: 14px; border: 2px solid var(--border); border-radius: 10px; background: var(--surface); cursor: pointer; text-align: left; font-family: inherit; }
        .role-btn:hover { border-color: var(--living); }
        .role-btn.selected { border-color: var(--living); background: var(--living-light); }
        .role-icon { width: 36px; height: 36px; background: var(--bg); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .role-info { flex: 1; }
        .role-name { font-weight: 600; font-size: 14px; }
        .role-desc { font-size: 11px; color: var(--text-secondary); }
        .start-btn { width: 100%; padding: 14px; background: var(--living); color: white; border: none; border-radius: 8px; font-family: inherit; font-size: 15px; font-weight: 600; cursor: pointer; }
        .start-btn:disabled { background: var(--border-strong); cursor: not-allowed; }
        .elig-item { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
        .elig-item:hover { background: var(--bg); }
        .elig-item.checked { background: var(--success-light); border-color: var(--success); }
        .elig-check { width: 22px; height: 22px; border: 2px solid var(--border-strong); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .elig-item.checked .elig-check { background: var(--success); border-color: var(--success); }
        .elig-check svg { color: white; display: none; }
        .elig-item.checked .elig-check svg { display: block; }
        .page { display: none; }
        .page.active { display: block; }
        .freeze-banner { background: var(--danger); color: white; padding: 12px 16px; text-align: center; font-weight: 600; }
        .freeze-banner.hidden { display: none; }
        .dod-section { margin-bottom: 24px; }
        .dod-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; padding: 12px; border-radius: 8px; }
        .dod-header.phase-a { background: var(--purple-light); }
        .dod-header.phase-b { background: var(--living-light); }
        .dod-header.phase-c { background: var(--warning-light); }
        .dod-header.phase-d { background: var(--success-light); }
        .dod-header.phase-e { background: var(--danger-light); }
        .dod-title { font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .dod-gate-status { padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .gate-pending { background: var(--bg); color: var(--text-muted); }
        .gate-ready { background: var(--warning-light); color: var(--warning); }
        .gate-passed { background: var(--success-light); color: var(--success); }
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; opacity: 0; animation: confetti-fall 3s ease-out forwards; }
        @keyframes confetti-fall { 0% { transform: translateY(-100px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .day-jump-modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); display: none; align-items: center; justify-content: center; z-index: 1001; }
        .day-jump-modal.visible { display: flex; }
        .day-jump-card { background: var(--surface); border-radius: 12px; padding: 24px; width: 280px; text-align: center; max-width: calc(100vw - 32px); }
        .day-jump-input { width: 100px; padding: 12px; font-size: 24px; font-weight: 700; text-align: center; border: 2px solid var(--living); border-radius: 8px; }
        .bootcamp-card { background: linear-gradient(135deg, var(--living-light) 0%, var(--bg) 100%); border: 2px solid var(--living); border-radius: 12px; padding: 20px; margin-bottom: 16px; }
        .bootcamp-title { font-weight: 700; color: var(--living); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .bootcamp-modules { display: grid; gap: 8px; }
        .bootcamp-module { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; }
        .bootcamp-module.completed { background: var(--success-light); border-color: var(--success); }
        .bootcamp-module-check { width: 24px; height: 24px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .bootcamp-module.completed .bootcamp-module-check { background: var(--success); border-color: var(--success); color: white; }
        .bootcamp-module-info { flex: 1; }
        .bootcamp-module-name { font-weight: 600; font-size: 13px; }
        .bootcamp-module-time { font-size: 11px; color: var(--text-muted); }
        .story-card { background: linear-gradient(135deg, var(--surface) 0%, var(--bg) 100%); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 20px; overflow: hidden; }
        .story-header { background: linear-gradient(135deg, #10B981 0%, #047857 100%); color: white; padding: 20px; cursor: pointer; }
        .story-header:hover { background: linear-gradient(135deg, #34D399 0%, #10B981 100%); }
        .story-number { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 4px; }
        .story-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
        .story-hook { font-size: 14px; opacity: 0.9; font-style: italic; }
        .story-body { display: none; padding: 0; }
        .story-body.open { display: block; }
        .story-scene { padding: 20px; border-bottom: 1px solid var(--border); }
        .story-scene:last-child { border-bottom: none; }
        .scene-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
        .scene-content { font-size: 14px; line-height: 1.7; }
        .story-question { background: var(--living-light); border-left: 4px solid var(--living); padding: 16px; margin: 16px 0; font-size: 15px; font-weight: 600; font-style: italic; color: var(--living); }
        .story-contrast { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
        .contrast-box { padding: 16px; border-radius: 8px; }
        .contrast-wrong { background: var(--danger-light); border: 1px solid var(--danger); }
        .contrast-right { background: var(--success-light); border: 1px solid var(--success); }
        .contrast-label { font-size: 11px; text-transform: uppercase; font-weight: 700; margin-bottom: 8px; }
        .contrast-wrong .contrast-label { color: var(--danger); }
        .contrast-right .contrast-label { color: var(--success); }
        .story-moral { background: linear-gradient(135deg, var(--success-light) 0%, #d1fae5 100%); border: 2px solid var(--success); border-radius: 8px; padding: 20px; margin-top: 16px; }
        .moral-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--success); font-weight: 700; margin-bottom: 8px; }
        .moral-text { font-size: 15px; font-weight: 600; color: var(--success); }
        .story-reflection { background: var(--purple-light); border-radius: 8px; padding: 16px; margin-top: 16px; }
        .reflection-question { font-size: 14px; color: var(--purple); font-weight: 600; margin-bottom: 8px; }
        @media (max-width: 640px) { .story-contrast { grid-template-columns: 1fr; } }
        .achievements-panel { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid var(--warning); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .achievements-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .achievements-title { font-weight: 700; font-size: 15px; color: #92400e; display: flex; align-items: center; gap: 8px; }
        .achievements-count { background: var(--warning); color: white; padding: 2px 10px; border-radius: 12px; font-size: 12px; font-weight: 700; }
        .achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
        .achievement { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; text-align: center; opacity: 0.4; transition: all 0.3s; }
        .achievement.earned { opacity: 1; border-color: var(--warning); box-shadow: 0 2px 8px rgba(217, 119, 6, 0.2); }
        .achievement-icon { font-size: 24px; margin-bottom: 4px; }
        .achievement-name { font-size: 11px; font-weight: 600; color: var(--text); }
        .achievement-desc { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
        .achievement.earned .achievement-icon { animation: achievePulse 0.5s ease; }
        @keyframes achievePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .standup-btn { background: linear-gradient(135deg, var(--living) 0%, #047857 100%); color: white; border: none; padding: 10px 16px; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 16px; }
        .standup-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
        .standup-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .standup-modal.open { display: flex; }
        .standup-card { background: var(--surface); border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .standup-section { background: var(--bg); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .standup-label { font-size: 11px; text-transform: uppercase; font-weight: 700; color: var(--text-muted); margin-bottom: 6px; }
        .standup-items { font-size: 13px; }
        .standup-item { padding: 4px 0; display: flex; align-items: flex-start; gap: 6px; }
        .standup-copy { background: var(--success); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 8px; }
        .standup-copy:hover { background: #047857; }
        .help-tip { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; background: var(--text-muted); color: white; border-radius: 50%; font-size: 11px; font-weight: 700; cursor: help; margin-left: 4px; position: relative; }
        .help-tip:hover { background: var(--living); }
        .help-tip::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--text); color: white; padding: 8px 12px; border-radius: 6px; font-size: 11px; font-weight: 400; white-space: normal; width: 200px; text-align: left; opacity: 0; visibility: hidden; transition: all 0.2s; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .help-tip:hover::after { opacity: 1; visibility: visible; }
        .help-tip::before { content: ''; position: absolute; bottom: calc(100% + 2px); left: 50%; transform: translateX(-50%); border: 6px solid transparent; border-top-color: var(--text); opacity: 0; visibility: hidden; transition: all 0.2s; }
        .help-tip:hover::before { opacity: 1; visibility: visible; }
        .handoff-card { background: linear-gradient(135deg, var(--purple-light) 0%, var(--bg) 100%); border: 1px solid var(--purple); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .handoff-title { font-weight: 700; color: var(--purple); font-size: 13px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .handoff-items { display: grid; gap: 4px; }
        .handoff-item { font-size: 12px; display: flex; align-items: center; gap: 6px; }
        .handoff-item input { margin: 0; }
        .example-box { background: var(--living-light); border: 1px solid var(--living); border-radius: 8px; padding: 16px; margin: 12px 0; }
        .example-title { font-weight: 700; color: var(--living); margin-bottom: 8px; }
        .example-step { background: var(--surface); border-radius: 6px; padding: 10px; margin-bottom: 8px; font-size: 13px; }
        .example-step-num { display: inline-block; width: 20px; height: 20px; background: var(--living); color: white; border-radius: 50%; text-align: center; line-height: 20px; font-size: 11px; font-weight: 700; margin-right: 8px; }
        .prisma-warning { background: var(--danger-light); border: 1px solid var(--danger); border-radius: 6px; padding: 8px 12px; font-size: 12px; color: var(--danger); margin-top: 8px; display: none; }
        .prisma-warning.visible { display: block; }
        .prisma-valid { background: var(--success-light); border: 1px solid var(--success); color: var(--success); }
        .prisma-calc { font-size: 11px; color: var(--text-muted); margin-top: 4px; font-style: italic; }
        :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
        .modal-card, .onboarding-card { box-shadow: 0 20px 60px rgba(0,0,0,0.25); }
        @media (max-width: 640px) {
            .header-inner { flex-direction: column; align-items: stretch; }
            .header-controls { justify-content: center; }
            .health-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 641px) and (max-width: 899px) {
            .health-grid { grid-template-columns: repeat(3, 1fr); }
            .role-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media print {
            .header, .tabs, .toast, .modal, .onboarding, .day-jump-modal, .confetti-container { display: none !important; }
            body { background: white !important; color: black !important; }
            .card { break-inside: avoid; box-shadow: none; }
            .container { max-width: 100%; }
        }
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
        }

        /* 2-Tier Tab System */
        .tab-more-wrapper { position: relative; display: inline-flex; }
        .tab-more-btn { padding: 12px 16px; border: none; background: none; font-family: inherit; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: 6px; white-space: nowrap; display: flex; align-items: center; gap: 4px; }
        .tab-more-btn:hover { background: var(--bg); }
        .tab-more-btn.has-active { color: var(--living); }
        .tab-more-dropdown { display: none; position: absolute; top: 100%; right: 0; min-width: 220px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; box-shadow: 0 8px 24px rgba(0,0,0,0.12); z-index: 200; padding: 4px; }
        .tab-more-dropdown.visible { display: block; }
        .tab-more-item { display: block; width: 100%; padding: 10px 14px; border: none; background: none; font-family: inherit; font-size: 13px; font-weight: 500; color: var(--text-secondary); cursor: pointer; border-radius: 6px; text-align: left; white-space: nowrap; }
        .tab-more-item:hover { background: var(--bg); }
        .tab-more-item:focus-visible { outline: 2px solid var(--accent); outline-offset: -2px; }
        .tab-more-item.active { background: var(--living-light); color: var(--living); }
        .dark-mode .tab-more-dropdown { box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
    </style>
</head>
<body>

<div class="toast" id="toast" aria-live="polite" aria-atomic="true"><span id="toastIcon">✓</span><span id="toastText">Saved</span></div>
<div class="confetti-container" id="confettiContainer" aria-hidden="true"></div>

<div class="day-jump-modal" id="dayJumpModal" onclick="closeDayJump(event)">
    <div class="day-jump-card" onclick="event.stopPropagation()">
        <div style="font-weight:700;margin-bottom:16px">Jump to Day</div>
        <input type="number" class="day-jump-input" id="dayJumpInput" inputmode="numeric" aria-label="Jump to day (1-40)" min="1" max="40" value="1" onkeydown="handleDayJumpKey(event)">
        <div class="btn-row" style="justify-content:center;margin-top:16px">
            <button class="download-btn" onclick="closeDayJump()">Cancel</button>
            <button class="copy-btn" onclick="jumpToDay()">Go</button>
        </div>
    </div>
</div>

<!-- BOOTCAMP MODAL -->
<div class="modal" id="bootcampModal" role="dialog" aria-modal="true">
    <div class="modal-card" style="max-width:700px">
        <div class="modal-header">
            <div class="modal-title">LIVING Bootcamp</div>
            <button class="modal-close" aria-label="Close" onclick="closeModal('bootcampModal')">&times;</button>
        </div>
        <div class="modal-body" id="bootcampContent">
            <div class="bootcamp-lesson" id="lesson-fundamentals">
                <h3 style="color:var(--living);margin-bottom:12px">Module 1: Living Systematic Review Fundamentals (10 min)</h3>
                <div style="background:var(--bg);padding:16px;border-radius:8px;margin-bottom:16px">
                    <p><strong>What is a Living Systematic Review?</strong></p>
                    <p style="margin:8px 0">A living systematic review is continually updated, incorporating relevant new evidence as it becomes available. Unlike traditional reviews that become outdated, living reviews remain current through regular update cycles.</p>
                    <p style="margin-top:12px"><strong>Key Components:</strong></p>
                    <ul style="margin:8px 0 0 20px;font-size:13px">
                        <li><strong>Update Frequency:</strong> Pre-defined schedule (monthly, quarterly, or triggered)</li>
                        <li><strong>Update Triggers:</strong> New RCT, safety signal, guideline request, or threshold reached</li>
                        <li><strong>Stopping Criteria:</strong> When to cease updates (evidence stable, question answered)</li>
                        <li><strong>Version Control:</strong> Tracking changes between updates</li>
                    </ul>
                </div>
                <div style="background:var(--warning-light);padding:12px;border-radius:8px;border:1px solid var(--warning);font-size:13px">
                    <strong>Common Mistake:</strong> Starting a living review without a sustainability plan. Team burnout is the leading cause of living review failure.
                </div>
            </div>
            <div class="bootcamp-lesson" id="lesson-triggers" style="display:none">
                <h3 style="color:var(--living);margin-bottom:12px">Module 2: Update Triggers and Frequency (10 min)</h3>
                <div style="background:var(--bg);padding:16px;border-radius:8px;margin-bottom:16px">
                    <p><strong>Choosing Update Strategy</strong></p>
                    <table class="ref-table" style="font-size:12px;margin-top:8px">
                        <thead><tr><th>Strategy</th><th>When to Use</th><th>Pros/Cons</th></tr></thead>
                        <tbody>
                            <tr><td><strong>Calendar-based</strong></td><td>Stable evidence flow</td><td>Predictable but may be wasteful</td></tr>
                            <tr><td><strong>Triggered</strong></td><td>Sporadic evidence</td><td>Efficient but requires monitoring</td></tr>
                            <tr><td><strong>Hybrid</strong></td><td>Most situations</td><td>Flexible, recommended approach</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="bootcamp-lesson" id="lesson-automation" style="display:none">
                <h3 style="color:var(--living);margin-bottom:12px">Module 3: Automated Search Monitoring (10 min)</h3>
                <div style="background:var(--bg);padding:16px;border-radius:8px;margin-bottom:16px">
                    <p><strong>Setting Up Automated Alerts</strong></p>
                    <ul style="margin:8px 0 0 20px;font-size:13px">
                        <li><strong>PubMed Alerts:</strong> Save search and enable email notifications</li>
                        <li><strong>Trial Registries:</strong> Monitor ClinicalTrials.gov, ISRCTN for results posting</li>
                        <li><strong>Preprint Servers:</strong> Set up alerts for medRxiv, bioRxiv</li>
                        <li><strong>RSS Feeds:</strong> Journal table-of-contents alerts</li>
                    </ul>
                </div>
            </div>
            <div class="bootcamp-lesson" id="lesson-sequential" style="display:none">
                <h3 style="color:var(--living);margin-bottom:12px">Module 4: Sequential Analysis Methods (10 min)</h3>
                <div style="background:var(--bg);padding:16px;border-radius:8px;margin-bottom:16px">
                    <p><strong>Cumulative Meta-Analysis and Alpha Spending</strong></p>
                    <p style="margin:8px 0">When continuously updating a meta-analysis, multiple testing inflates Type I error. Sequential methods control this.</p>
                    <ul style="margin:8px 0 0 20px;font-size:13px">
                        <li><strong>Trial Sequential Analysis:</strong> Monitoring boundaries for cumulative meta-analysis</li>
                        <li><strong>Alpha Spending:</strong> Controls overall false positive rate across updates</li>
                        <li><strong>Information Size:</strong> Required sample size for conclusive evidence</li>
                    </ul>
                </div>
            </div>
            <div class="bootcamp-lesson" id="lesson-sustainability" style="display:none">
                <h3 style="color:var(--living);margin-bottom:12px">Module 5: Sustainability Planning (5 min)</h3>
                <div style="background:var(--bg);padding:16px;border-radius:8px;margin-bottom:16px">
                    <p><strong>Avoiding Living Review Burnout</strong></p>
                    <ul style="margin:8px 0 0 20px;font-size:13px">
                        <li><strong>Author Rotation:</strong> Plan for team member turnover</li>
                        <li><strong>Documentation:</strong> Detailed SOPs for each update step</li>
                        <li><strong>Automation:</strong> Reduce manual work wherever possible</li>
                        <li><strong>Funding:</strong> Secure long-term support before starting</li>
                    </ul>
                </div>
                <div style="background:var(--danger-light);padding:12px;border-radius:8px;border:1px solid var(--danger);font-size:13px">
                    <strong>CAUTION:</strong> Without sustainability planning, most living reviews fail within 2 years.
                </div>
            </div>
            <div class="btn-row" style="justify-content:space-between;margin-top:20px">
                <button class="download-btn" id="prevLessonBtn" onclick="prevLesson()" disabled>Previous</button>
                <span id="lessonCounter" style="font-weight:600;color:var(--text-secondary)">1 / 5</span>
                <button class="copy-btn" id="nextLessonBtn" onclick="nextLesson()">Next</button>
            </div>
        </div>
    </div>
</div>

<!-- ONBOARDING -->
<div class="onboarding" id="onboarding">
    <div class="onboarding-card">
        <div class="onboarding-header">
            <div style="font-size:32px;margin-bottom:8px">&#x267B;</div>
            <h2 style="font-size:22px;margin-bottom:4px">META-SPRINT LIVING</h2>
            <p style="opacity:0.9;font-size:14px">Living Systematic Review in 40 Days</p>
        </div>
        <div class="onboarding-body" id="step1">
            <div style="text-align:center;margin-bottom:20px">
                <div style="font-size:18px;font-weight:700;margin-bottom:8px">Eligibility Check</div>
                <p style="color:var(--text-secondary);font-size:13px">All criteria must be met for LIVING workflow</p>
            </div>
            <div class="eligibility-list">
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>Rapid evidence base</strong> with frequent new studies expected</div>
                </div>
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>High-impact question</strong> where currency matters for decisions</div>
                </div>
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>Long-term funding</strong> secured for ongoing updates</div>
                </div>
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>Automated search alerts</strong> feasible for key databases</div>
                </div>
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>Sustainability plan</strong> for author rotation</div>
                </div>
                <div class="elig-item" onclick="toggleElig(this)">
                    <div class="elig-check"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                    <div><strong>12-person team</strong> available with rotating capacity</div>
                </div>
            </div>
            <button class="start-btn" id="nextBtn1" disabled onclick="goToStep2()">Continue</button>
        </div>
        <div id="step2" style="display:none">
            <div class="onboarding-body">
                <div style="text-align:center;margin-bottom:20px">
                    <div style="font-size:18px;font-weight:700;margin-bottom:8px">Select Your Role</div>
                    <p style="color:var(--text-secondary);font-size:13px">LIVING requires specialized roles</p>
                </div>
                <div class="role-grid">
                    <button class="role-btn" onclick="selectRole(this, 'integrator')">
                        <div class="role-icon">&#x1F3AF;</div>
                        <div class="role-info"><div class="role-name">Integrator</div><div class="role-desc">Long-term lead, owns gates and sustainability</div></div>
                    </button>
                    <button class="role-btn" onclick="selectRole(this, 'deputy')">
                        <div class="role-icon">&#x1F4CB;</div>
                        <div class="role-info"><div class="role-name">Deputy Integrator</div><div class="role-desc">Rotating backup, decision queue</div></div>
                    </button>
                    <button class="role-btn" onclick="selectRole(this, 'alerts')">
                        <div class="role-icon">&#x1F514;</div>
                        <div class="role-info"><div class="role-name">Alert Monitoring Pod</div><div class="role-desc">2 people. Search alerts, preprints, registries</div></div>
                    </button>
                    <button class="role-btn" onclick="selectRole(this, 'extraction')">
                        <div class="role-icon">&#x1F4CA;</div>
                        <div class="role-info"><div class="role-name">Rapid Extraction Pod</div><div class="role-desc">4 people. Quick data extraction workflow</div></div>
                    </button>
                    <button class="role-btn" onclick="selectRole(this, 'analysis')">
                        <div class="role-icon">&#x1F4C8;</div>
                        <div class="role-info"><div class="role-name">Analysis Pod</div><div class="role-desc">2 people. Cumulative meta-analysis, sequential</div></div>
                    </button>
                    <button class="role-btn" onclick="selectRole(this, 'write')">
                        <div class="role-icon">&#x270D;</div>
                        <div class="role-info"><div class="role-name">Write Pod</div><div class="role-desc">2 people. Manuscript updates, changelog</div></div>
                    </button>
                </div>
                <button class="start-btn" id="startBtn" disabled onclick="startApp()">Start META-SPRINT LIVING</button>
            </div>
        </div>
    </div>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none">
    <div class="freeze-banner hidden" id="freezeBanner">FREEZE DAY 34 - No new protocol changes</div>
    <header class="header">
        <div class="header-inner">
            <div class="logo">META-SPRINT <span class="living-badge">LIVING</span> <span>V1.0</span></div>
            <div class="header-controls">
                <div class="role-badge" id="roleBadge" tabindex="0" role="button" onclick="showRoleChange()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">Integrator</div>
                <div class="day-control">
                    <button class="day-btn" id="prevDayBtn" onclick="changeDay(-1)">&#x2190;</button>
                    <div>
                        <div class="day-display" tabindex="0" role="button" onclick="showDayJump()" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">Day <span id="dayNum">1</span>/40</div>
                        <div class="day-hint">click to jump</div>
                    </div>
                    <button class="day-btn" id="nextDayBtn" onclick="changeDay(1)">&#x2192;</button>
                </div>
                <button class="day-btn" onclick="toggleDarkMode()" id="darkModeBtn">&#x1F319;</button>
                <button class="day-btn" onclick="openModal('settingsModal')">&#x2699;</button>
            </div>
        </div>
    </header>
    <div class="tabs" role="tablist">
        <button class="tab active" role="tab" aria-selected="true" onclick="showPage('today', this)">Today</button>
        <button class="tab" role="tab" aria-selected="false" onclick="showPage('timeline', this)">Timeline</button>
        <button class="tab" role="tab" aria-selected="false" onclick="showPage('updates', this)">Updates</button>
        <button class="tab" role="tab" aria-selected="false" onclick="showPage('dod', this)">Checkpoints (DoD)</button>
        <button class="tab" role="tab" aria-selected="false" onclick="showPage('templates', this)">Templates</button>
        <div class="tab-more-wrapper">
            <button class="tab-more-btn" onclick="toggleMoreTabs(event)" aria-expanded="false" aria-haspopup="true" title="More pages">More ▾</button>
            <div class="tab-more-dropdown" id="moreTabsDropdown" role="menu">
                <button class="tab-more-item" data-page="stories" onclick="showPageFromMore('stories', this)" role="menuitem">Stories</button>
                <button class="tab-more-item" data-page="reference" onclick="showPageFromMore('reference', this)" role="menuitem">Reference</button>
                <button class="tab-more-item" data-page="glossary" onclick="showPageFromMore('glossary', this)" role="menuitem">Glossary</button>
            </div>
        </div>
    </div>
    <div class="container">
        <!-- TODAY PAGE -->
        <div class="page active" id="page-today" role="tabpanel">
            <div class="health-dashboard" id="healthDashboard">
                <div class="health-header">
                    <div class="health-title">LIVING Project Health</div>
                    <div class="health-score" id="healthScore">--</div>
                </div>
                <div class="health-grid">
                    <div class="health-stat">
                        <div class="health-stat-value" id="daysRemaining">40</div>
                        <div class="health-stat-label">Days Left</div>
                    </div>
                    <div class="health-stat">
                        <div class="health-stat-value" id="updateCount">0</div>
                        <div class="health-stat-label">Updates</div>
                    </div>
                    <div class="health-stat" onclick="promptStudyCount()" style="cursor:pointer" title="Click to update">
                        <div class="health-stat-value" id="studyCount">0</div>
                        <div class="health-stat-label">Studies</div>
                    </div>
                    <div class="health-stat">
                        <div class="health-stat-value" id="gatesPassed">0/5</div>
                        <div class="health-stat-label">Gates</div>
                    </div>
                </div>
                <div class="gate-dots">
                    <div class="gate-dot" id="gateA" title="DoD-A-LIVING">A</div>
                    <div class="gate-dot" id="gateB" title="DoD-B-LIVING">B</div>
                    <div class="gate-dot" id="gateC" title="DoD-C-LIVING">C</div>
                    <div class="gate-dot" id="gateD" title="DoD-D-LIVING">D</div>
                    <div class="gate-dot" id="gateE" title="DoD-E-LIVING">E</div>
                </div>
            </div>
            
            <div class="risk-panel" id="riskPanel">
                <div class="risk-header">
                    <div class="risk-title">Project Risk</div>
                    <div class="risk-badge low" id="riskStatusBadge" aria-live="polite">LOW</div>
                </div>
                <ul class="risk-list" id="riskList" aria-live="polite">
                    <li class="risk-item">No active risks. Keep daily outputs on schedule.</li>
                </ul>
            </div>
            <div id="deadlineAlerts"></div>
            <div class="achievements-panel" id="achievementsPanel">
                <div class="achievements-header">
                    <div class="achievements-title">Achievements <span class="achievements-count" id="achieveCount">0/10</span></div>
                    <button class="standup-btn" onclick="openStandupModal()">Generate Standup</button>
                </div>
                <div class="achievements-grid" id="achievementsGrid">
                    <div class="achievement" id="ach-bootcamp" data-check="bootcamp">
                        <div class="achievement-icon">&#x1F393;</div>
                        <div class="achievement-name">Scholar</div>
                        <div class="achievement-desc">Complete LIVING Bootcamp</div>
                    </div>
                    <div class="achievement" id="ach-protocol" data-check="dodA">
                        <div class="achievement-icon">&#x1F512;</div>
                        <div class="achievement-name">Protocol Locked</div>
                        <div class="achievement-desc">Pass DoD-A-LIVING</div>
                    </div>
                    <div class="achievement" id="ach-alerts" data-check="alerts">
                        <div class="achievement-icon">&#x1F514;</div>
                        <div class="achievement-name">Alert Master</div>
                        <div class="achievement-desc">Configure search alerts</div>
                    </div>
                    <div class="achievement" id="ach-search" data-check="dodB">
                        <div class="achievement-icon">&#x1F50D;</div>
                        <div class="achievement-name">Search Master</div>
                        <div class="achievement-desc">Pass DoD-B-LIVING</div>
                    </div>
                    <div class="achievement" id="ach-prisma" data-check="prisma">
                        <div class="achievement-icon">&#x1F4CA;</div>
                        <div class="achievement-name">PRISMA Complete</div>
                        <div class="achievement-desc">Fill all PRISMA counts</div>
                    </div>
                    <div class="achievement" id="ach-extraction" data-check="dodC">
                        <div class="achievement-icon">&#x1F4CB;</div>
                        <div class="achievement-name">Data Extractor</div>
                        <div class="achievement-desc">Pass DoD-C-LIVING</div>
                    </div>
                    <div class="achievement" id="ach-cumulative" data-check="cumulative">
                        <div class="achievement-icon">&#x1F4C8;</div>
                        <div class="achievement-name">Cumulative Analyst</div>
                        <div class="achievement-desc">Complete cumulative MA</div>
                    </div>
                    <div class="achievement" id="ach-analysis" data-check="dodD">
                        <div class="achievement-icon">&#x2705;</div>
                        <div class="achievement-name">Analysis Complete</div>
                        <div class="achievement-desc">Pass DoD-D-LIVING</div>
                    </div>
                    <div class="achievement" id="ach-stories" data-check="stories">
                        <div class="achievement-icon">&#x1F4D6;</div>
                        <div class="achievement-name">Storyteller</div>
                        <div class="achievement-desc">Read all 4 stories</div>
                    </div>
                    <div class="achievement" id="ach-submission" data-check="dodE">
                        <div class="achievement-icon">&#x1F3C1;</div>
                        <div class="achievement-name">Submission Ready</div>
                        <div class="achievement-desc">Pass DoD-E-LIVING</div>
                    </div>
                </div>
            </div>
            <div class="standup-modal" id="standupModal" onclick="closeStandupModal(event)">
                <div class="standup-card" onclick="event.stopPropagation()">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                        <div style="font-weight:700;font-size:16px">Daily Standup</div>
                        <button onclick="closeStandupModal()" style="background:none;border:none;font-size:20px;cursor:pointer;color:var(--text-muted)" aria-label="Close">&times;</button>
                    </div>
                    <div class="standup-section">
                        <div class="standup-label">Yesterday (Completed)</div>
                        <div class="standup-items" id="standupYesterday">Loading...</div>
                    </div>
                    <div class="standup-section">
                        <div class="standup-label">Today (Planned)</div>
                        <div class="standup-items" id="standupToday">Loading...</div>
                    </div>
                    <div class="standup-section">
                        <div class="standup-label">Blockers</div>
                        <div class="standup-items" id="standupBlockers">Loading...</div>
                    </div>
                    <div class="standup-section" style="background:var(--living-light)">
                        <div class="standup-label" style="color:var(--living)">Status</div>
                        <div class="standup-items" id="standupStatus">Loading...</div>
                    </div>
                    <button class="standup-copy" onclick="copyStandup()">Copy to Clipboard</button>
                </div>
            </div>
            <div class="bootcamp-card" id="bootcampCard">
                <div class="bootcamp-title">LIVING Bootcamp (Day 1 - 45 min total)</div>
                <p style="font-size:13px;color:var(--text-secondary);margin-bottom:12px">Complete all modules before starting work</p>
                <div class="bootcamp-modules">
                    <div class="bootcamp-module" tabindex="0" onclick="toggleBootcamp(this, 'fundamentals')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                        <div class="bootcamp-module-check">&#x2713;</div>
                        <div class="bootcamp-module-info">
                            <div class="bootcamp-module-name">1. Living SR Fundamentals</div>
                            <div class="bootcamp-module-time">10 min</div>
                        </div>
                    </div>
                    <div class="bootcamp-module" tabindex="0" onclick="toggleBootcamp(this, 'triggers')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                        <div class="bootcamp-module-check">&#x2713;</div>
                        <div class="bootcamp-module-info">
                            <div class="bootcamp-module-name">2. Update Triggers and Frequency</div>
                            <div class="bootcamp-module-time">10 min</div>
                        </div>
                    </div>
                    <div class="bootcamp-module" tabindex="0" onclick="toggleBootcamp(this, 'automation')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                        <div class="bootcamp-module-check">&#x2713;</div>
                        <div class="bootcamp-module-info">
                            <div class="bootcamp-module-name">3. Automated Search Monitoring</div>
                            <div class="bootcamp-module-time">10 min</div>
                        </div>
                    </div>
                    <div class="bootcamp-module" tabindex="0" onclick="toggleBootcamp(this, 'sequential')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                        <div class="bootcamp-module-check">&#x2713;</div>
                        <div class="bootcamp-module-info">
                            <div class="bootcamp-module-name">4. Sequential Analysis Methods</div>
                            <div class="bootcamp-module-time">10 min</div>
                        </div>
                    </div>
                    <div class="bootcamp-module" tabindex="0" onclick="toggleBootcamp(this, 'sustainability')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                        <div class="bootcamp-module-check">&#x2713;</div>
                        <div class="bootcamp-module-info">
                            <div class="bootcamp-module-name">5. Sustainability Planning</div>
                            <div class="bootcamp-module-time">5 min</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="alert alert-info" id="todayGoal">
                <div class="alert-icon">&#x1F3AF;</div>
                <div class="alert-content">
                    <div class="alert-title">Today's Goal</div>
                    <div class="alert-text" id="goalText">Complete Bootcamp + Define Update Strategy</div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Your Tasks</div>
                    <div class="phase-badge phase-a" id="phaseBadge">Protocol</div>
                </div>
                <div class="card-body" id="tasksContainer"></div>
            </div>
        </div>

        <!-- UPDATES PAGE -->
        <div class="page" id="page-updates" role="tabpanel">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Living Review Update Configuration</div>
                    <span class="living-indicator">LIVING-SPECIFIC</span>
                </div>
                <div class="card-body">
                    <h4 style="margin-bottom:12px">Update Strategy</h4>
                    <div class="form-row">
                        <label class="form-label">Update Frequency</label>
                        <select class="form-input" id="updateFrequency">
                            <option value="">Select...</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="biannual">Bi-annual</option>
                            <option value="triggered">Triggered only</option>
                            <option value="hybrid">Hybrid (calendar + triggered)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label class="form-label">Update Triggers (check all that apply)</label>
                        <div style="display:grid;gap:8px">
                            <label><input type="checkbox" id="trigger-rct"> New RCT published</label>
                            <label><input type="checkbox" id="trigger-safety"> Safety signal identified</label>
                            <label><input type="checkbox" id="trigger-guideline"> Guideline body request</label>
                            <label><input type="checkbox" id="trigger-threshold"> Information threshold reached</label>
                            <label><input type="checkbox" id="trigger-major"> Major study results posted</label>
                        </div>
                    </div>
                    <div class="form-row">
                        <label class="form-label">Stopping Criteria</label>
                        <textarea class="form-textarea" id="stoppingCriteria" placeholder="e.g., Evidence stable for 2 consecutive updates&#10;Question answered with high certainty&#10;Superseded by newer interventions&#10;Resources no longer available"></textarea>
                    </div>
                    <button class="copy-btn" onclick="saveUpdateConfig()">Save Update Configuration</button>
                    <h4 style="margin:24px 0 12px">Search Alert Status</h4>
                    <div id="alertStatus">
                        <div class="checklist-item" onclick="toggleAlert(this, 'pubmed')">
                            <div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                            <div class="checklist-content"><div class="checklist-title">PubMed alerts configured</div></div>
                        </div>
                        <div class="checklist-item" onclick="toggleAlert(this, 'cochrane')">
                            <div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                            <div class="checklist-content"><div class="checklist-title">Cochrane CENTRAL alerts configured</div></div>
                        </div>
                        <div class="checklist-item" onclick="toggleAlert(this, 'trials')">
                            <div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                            <div class="checklist-content"><div class="checklist-title">Trial registry monitoring active</div></div>
                        </div>
                        <div class="checklist-item" onclick="toggleAlert(this, 'preprints')">
                            <div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                            <div class="checklist-content"><div class="checklist-title">Preprint server alerts (medRxiv/bioRxiv)</div></div>
                        </div>
                        <div class="checklist-item" onclick="toggleAlert(this, 'rss')">
                            <div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>
                            <div class="checklist-content"><div class="checklist-title">RSS feeds / ToC alerts active</div></div>
                        </div>
                    </div>
                    <h4 style="margin:24px 0 12px">Version History</h4>
                    <div class="form-row">
                        <textarea class="form-textarea" id="versionHistory" style="min-height:120px;font-family:'IBM Plex Mono',monospace;font-size:12px" placeholder="v1.0 (Initial) - YYYY-MM-DD - X studies included&#10;v1.1 - YYYY-MM-DD - Added Y studies, conclusions unchanged&#10;v1.2 - YYYY-MM-DD - Added Z studies, updated recommendation"></textarea>
                    </div>
                    <button class="copy-btn" onclick="saveVersionHistory()">Save Version History</button>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">PRISMA Flow Tracker</div>
                    <span class="living-indicator">Auto-Validated</span>
                </div>
                <div class="card-body">
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px">Records Identified</label>
                            <input type="number" class="form-input" id="prismaIdentified" min="0" placeholder="0" onchange="validatePrisma();savePrismaFlow()">
                        </div>
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px">Duplicates Removed</label>
                            <input type="number" class="form-input" id="prismaDuplicates" min="0" placeholder="0" onchange="validatePrisma();savePrismaFlow()">
                        </div>
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px">Records Screened</label>
                            <input type="number" class="form-input" id="prismaScreened" min="0" placeholder="0" onchange="validatePrisma();savePrismaFlow()">
                        </div>
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px">Excluded at T/A</label>
                            <input type="number" class="form-input" id="prismaExcluded" min="0" placeholder="0" onchange="validatePrisma();savePrismaFlow()">
                        </div>
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px">Full-text Assessed</label>
                            <input type="number" class="form-input" id="prismaFullText" min="0" placeholder="0" onchange="validatePrisma();savePrismaFlow()">
                        </div>
                        <div class="form-row" style="margin:0">
                            <label class="form-label" style="font-size:11px;color:var(--success);font-weight:700">Studies Included</label>
                            <input type="number" class="form-input" id="prismaIncluded" min="0" placeholder="0" style="border-color:var(--success)" onchange="validatePrisma();savePrismaFlow();updateStudyCount()">
                        </div>
                    </div>
                    <div class="prisma-warning" id="prismaWarning" role="status" aria-live="polite"></div>
                </div>
            </div>
        </div>

        <!-- DOD GATES PAGE -->
        <div class="page" id="page-dod" role="tabpanel">
            <div class="alert alert-info">
                <div class="alert-icon">&#x267B;</div>
                <div class="alert-content">
                    <div class="alert-title">LIVING-Specific Checkpoints (DoD)</div>
                    <div class="alert-text">All gates include LIVING requirements: update triggers, stopping criteria, sequential analysis, sustainability plan</div>
                </div>
            </div>
            <div id="dodContainer"></div>
        </div>

        <!-- TIMELINE PAGE -->
        <div class="page" id="page-timeline" role="tabpanel">
            <div class="card">
                <div class="card-header"><div class="card-title">40-Day LIVING Timeline</div></div>
                <div class="card-body">
                    <div class="timeline-bar" role="progressbar" aria-valuemin="0" aria-valuemax="40" aria-valuenow="1" aria-label="Sprint progress" id="timelineBar"><div class="timeline-fill" id="timelineFill" style="width:0%"></div></div>
                    <div class="timeline-markers">
                        <div class="timeline-marker">D4<br>DoD-A</div>
                        <div class="timeline-marker">D12<br>DoD-B</div>
                        <div class="timeline-marker">D20<br>Audit1</div>
                        <div class="timeline-marker">D28<br>DoD-C</div>
                        <div class="timeline-marker">D34<br>DoD-D</div>
                        <div class="timeline-marker">D40<br>Submit</div>
                    </div>
                    <table class="ref-table" style="margin-top:24px">
                        <thead><tr><th>Phase</th><th>Days</th><th>Key Deliverables</th></tr></thead>
                        <tbody>
                            <tr><td><strong>DoD-A-LIVING</strong></td><td>1-4</td><td>Protocol + Update strategy + Stopping criteria locked</td></tr>
                            <tr><td><strong>DoD-B-LIVING</strong></td><td>6-12</td><td>Search + Alerts configured + Baseline studies</td></tr>
                            <tr><td><strong>DoD-C-LIVING</strong></td><td>12-28</td><td>Extraction + Rapid workflow tested</td></tr>
                            <tr><td><strong>DoD-D-LIVING</strong></td><td>24-34</td><td>Cumulative MA + Sequential analysis + Dashboard</td></tr>
                            <tr><td><strong>DoD-E-LIVING</strong></td><td>34-40</td><td>PRISMA-Living + Submission + Update plan active</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- STORIES PAGE -->
        <div class="page" id="page-stories" role="tabpanel">
            <div class="alert alert-info" style="margin-bottom:20px">
                <div class="alert-icon">&#x1F4D6;</div>
                <div class="alert-content">
                    <div class="alert-title">Evidence Reversal Stories</div>
                    <div class="alert-text">Learn from cases where living systematic reviews succeeded or failed. Click each story to expand.</div>
                </div>
            </div>

            <!-- STORY 1: The Premature Conclusion -->
            <div class="story-card">
                <div class="story-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleStory(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="story-number">Story One</div>
                    <div class="story-title">The Premature Conclusion</div>
                    <div class="story-hook">"The evidence is clear! We can stop updating now..." But what if the next trial changes everything?</div>
                </div>
                <div class="story-body">
                    <div class="story-scene">
                        <div class="scene-label">The Beginning</div>
                        <div class="scene-content">
                            <p>A living review of a new treatment showed consistent benefit across 8 trials: <strong>RR 0.72 [0.58-0.89]</strong>. The team declared "evidence stable" and stopped updates after 18 months.</p>
                            <p style="margin-top:12px">Guidelines adopted the recommendation. Clinical practice changed. Thousands of patients received the treatment.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Question You Must Ask</div>
                        <div class="story-question">
                            Were the stopping criteria pre-specified? Was there sufficient statistical power to detect important changes? Were any large trials still ongoing?
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Hidden Truth</div>
                        <div class="scene-content">
                            <p>Six months after updates stopped:</p>
                            <ul style="margin:12px 0 0 20px">
                                <li><strong>Large pragmatic trial (n=5,000):</strong> Found no benefit, RR 1.02 [0.91-1.14]</li>
                                <li><strong>Updated meta-analysis:</strong> RR 0.94 [0.85-1.04] - no longer significant</li>
                                <li><strong>Subgroup effect:</strong> Original benefit only in high-risk patients</li>
                                <li><strong>The reversal:</strong> Treatment ineffective for most patients</li>
                            </ul>
                            <p style="margin-top:12px">The premature stop led to <strong>18 months of inappropriate treatment</strong> for thousands of patients.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">Two Paths</div>
                        <div class="story-contrast">
                            <div class="contrast-box contrast-wrong">
                                <div class="contrast-label">What They Did</div>
                                <p style="font-size:13px">Stopped updates based on apparent stability. Ignored ongoing large trials. No sequential analysis boundaries.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Evidence reversal missed. Patients harmed by ineffective treatment.</p>
                            </div>
                            <div class="contrast-box contrast-right">
                                <div class="contrast-label">What META-SPRINT Would Do</div>
                                <p style="font-size:13px">Pre-specify stopping criteria with statistical boundaries. Monitor trial registries for ongoing studies. Continue until information size reached.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Reversal detected promptly. Guidelines updated. Patients protected.</p>
                            </div>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="story-moral">
                            <div class="moral-label">The Lesson</div>
                            <div class="moral-text">Never stop a living review based on intuition. Pre-specify stopping criteria. Use sequential analysis boundaries. Always check trial registries for ongoing studies before declaring "stable."</div>
                        </div>
                        <div class="story-reflection">
                            <div class="reflection-question">Reflect: What are your stopping criteria? Are any large trials still ongoing?</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STORY 2: The Alert Fatigue -->
            <div class="story-card">
                <div class="story-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleStory(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="story-number">Story Two</div>
                    <div class="story-title">The Alert Fatigue</div>
                    <div class="story-hook">"Another 50 alerts today... I'll check them tomorrow..." But what if a key trial was buried in the noise?</div>
                </div>
                <div class="story-body">
                    <div class="story-scene">
                        <div class="scene-label">The Beginning</div>
                        <div class="scene-content">
                            <p>A living review team set up comprehensive search alerts: PubMed, Embase, CENTRAL, trial registries, preprints. <strong>150 alerts per week</strong> flooded their inbox.</p>
                            <p style="margin-top:12px">Initially diligent, the team reviewed every alert. But after months, alert fatigue set in. Reviews became cursory.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Question You Must Ask</div>
                        <div class="story-question">
                            Is the alert volume sustainable? Are alerts prioritized effectively? Is there redundancy in the monitoring team?
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Hidden Truth</div>
                        <div class="scene-content">
                            <p>A critical safety signal was missed:</p>
                            <ul style="margin:12px 0 0 20px">
                                <li><strong>Week 47:</strong> Small case series reported rare but serious adverse event</li>
                                <li><strong>Alert buried:</strong> Among 200 alerts that week, flagged as "low priority"</li>
                                <li><strong>Week 52:</strong> Second case series confirmed the signal</li>
                                <li><strong>Week 60:</strong> Large cohort study published - RR 4.2 for adverse event</li>
                            </ul>
                            <p style="margin-top:12px">The living review was <strong>13 weeks late</strong> in updating. Regulatory action came before the review team acted.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">Two Paths</div>
                        <div class="story-contrast">
                            <div class="contrast-box contrast-wrong">
                                <div class="contrast-label">What They Did</div>
                                <p style="font-size:13px">Maximized sensitivity without considering workload. No prioritization system. Single person responsible.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Alert fatigue. Safety signal missed. Review credibility damaged.</p>
                            </div>
                            <div class="contrast-box contrast-right">
                                <div class="contrast-label">What META-SPRINT Would Do</div>
                                <p style="font-size:13px">Balance sensitivity with specificity. Use tiered prioritization. Rotate monitoring responsibility. Separate safety alerts.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Sustainable monitoring. Signals detected promptly. Trust maintained.</p>
                            </div>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="story-moral">
                            <div class="moral-label">The Lesson</div>
                            <div class="moral-text">More alerts is not better. Design for sustainability. Prioritize safety signals. Rotate responsibility. Alert fatigue kills living reviews.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STORY 3: The Unsustainable Living Review -->
            <div class="story-card">
                <div class="story-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleStory(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="story-number">Story Three</div>
                    <div class="story-title">The Unsustainable Living Review</div>
                    <div class="story-hook">"We're committed to keeping this current forever!" But what happens when the original team moves on?</div>
                </div>
                <div class="story-body">
                    <div class="story-scene">
                        <div class="scene-label">The Beginning</div>
                        <div class="scene-content">
                            <p>An enthusiastic team launched a living review on COVID-19 treatments. Updates monthly. High profile. <strong>Cited by WHO guidelines</strong>.</p>
                            <p style="margin-top:12px">The core team of 3 researchers managed everything. No documentation. No succession plan. "We'll always be here."</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Question You Must Ask</div>
                        <div class="story-question">
                            What happens when team members leave? Is the process documented? Is there institutional support beyond individual enthusiasm?
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Hidden Truth</div>
                        <div class="scene-content">
                            <p>Within 18 months:</p>
                            <ul style="margin:12px 0 0 20px">
                                <li><strong>Month 8:</strong> Lead researcher took new position - reduced involvement</li>
                                <li><strong>Month 12:</strong> Second team member went on parental leave</li>
                                <li><strong>Month 14:</strong> Third member burned out - took extended break</li>
                                <li><strong>Month 18:</strong> Review declared "no longer maintained"</li>
                            </ul>
                            <p style="margin-top:12px">A high-impact living review <strong>died of burnout</strong>. Users left without current evidence at a critical time.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">Two Paths</div>
                        <div class="story-contrast">
                            <div class="contrast-box contrast-wrong">
                                <div class="contrast-label">What They Did</div>
                                <p style="font-size:13px">Relied on enthusiasm alone. No documentation. No succession. No institutional backing.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Team burnout. Review abandoned. Users harmed by outdated evidence.</p>
                            </div>
                            <div class="contrast-box contrast-right">
                                <div class="contrast-label">What META-SPRINT Would Do</div>
                                <p style="font-size:13px">Document every process. Plan for rotation. Secure institutional support. Build larger team with defined roles.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Sustainable operations. Smooth transitions. Continuous updates.</p>
                            </div>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="story-moral">
                            <div class="moral-label">The Lesson</div>
                            <div class="moral-text">Enthusiasm is not sustainability. Document everything. Plan for turnover. Secure long-term support BEFORE starting. A dead living review is worse than no review.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STORY 4: The Shifting Baseline -->
            <div class="story-card">
                <div class="story-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleStory(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="story-number">Story Four</div>
                    <div class="story-title">The Shifting Baseline</div>
                    <div class="story-hook">"We improved our methods for this update!" But can you compare results across versions with different methods?</div>
                </div>
                <div class="story-body">
                    <div class="story-scene">
                        <div class="scene-label">The Beginning</div>
                        <div class="scene-content">
                            <p>A living review evolved over 3 years. Each update brought "improvements": better search strategy, refined inclusion criteria, updated risk of bias tool.</p>
                            <p style="margin-top:12px">Version 1.0 showed benefit. Version 2.0 showed stronger benefit. Version 3.0 showed no benefit. <strong>Readers were confused.</strong></p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Question You Must Ask</div>
                        <div class="story-question">
                            Are changes in conclusions due to new evidence or methodological drift? Can users compare versions meaningfully?
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">The Hidden Truth</div>
                        <div class="scene-content">
                            <p>Unpacking the version differences:</p>
                            <ul style="margin:12px 0 0 20px">
                                <li><strong>v1.0 to v2.0:</strong> Changed inclusion criteria - added observational studies</li>
                                <li><strong>v2.0 to v3.0:</strong> New RoB tool excluded 4 studies rated "low risk" before</li>
                                <li><strong>Confounded changes:</strong> New evidence AND new methods changed together</li>
                                <li><strong>Impossible to interpret:</strong> Was v3.0 "no benefit" due to new trials or new exclusions?</li>
                            </ul>
                            <p style="margin-top:12px">The review became <strong>uninterpretable</strong>. Users lost trust. Policymakers ignored subsequent updates.</p>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="scene-label">Two Paths</div>
                        <div class="story-contrast">
                            <div class="contrast-box contrast-wrong">
                                <div class="contrast-label">What They Did</div>
                                <p style="font-size:13px">Made ad hoc improvements. Mixed evidence changes with method changes. No sensitivity analyses.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Confounded updates. Lost credibility. Uninterpretable trend.</p>
                            </div>
                            <div class="contrast-box contrast-right">
                                <div class="contrast-label">What META-SPRINT Would Do</div>
                                <p style="font-size:13px">Lock methods at protocol. If changes needed, run parallel analyses. Document every deviation. Maintain interpretable version history.</p>
                                <p style="font-size:13px;margin-top:8px"><strong>Result:</strong> Clear attribution. Trustworthy trend. Maintained credibility.</p>
                            </div>
                        </div>
                    </div>
                    <div class="story-scene">
                        <div class="story-moral">
                            <div class="moral-label">The Lesson</div>
                            <div class="moral-text">Method stability enables evidence interpretation. Lock your protocol. If methods must change, run parallel analyses. Never mix evidence updates with method changes.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">The Four Lessons</div>
                </div>
                <div class="card-body">
                    <div style="display:grid;gap:12px">
                        <div style="padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--living)">
                            <strong>1. Pre-specify stopping criteria with statistical boundaries.</strong><br>
                            <span style="font-size:13px;color:var(--text-secondary)">Never stop based on intuition. Check for ongoing trials.</span>
                        </div>
                        <div style="padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--success)">
                            <strong>2. Design alerts for sustainability, not maximum sensitivity.</strong><br>
                            <span style="font-size:13px;color:var(--text-secondary)">Alert fatigue kills living reviews. Prioritize and rotate.</span>
                        </div>
                        <div style="padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--warning)">
                            <strong>3. Plan for sustainability from day one.</strong><br>
                            <span style="font-size:13px;color:var(--text-secondary)">Document everything. Plan for turnover. Secure institutional support.</span>
                        </div>
                        <div style="padding:12px;background:var(--bg);border-radius:8px;border-left:4px solid var(--purple)">
                            <strong>4. Lock methods to enable interpretation.</strong><br>
                            <span style="font-size:13px;color:var(--text-secondary)">Never mix evidence updates with method changes.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TEMPLATES PAGE -->
        <div class="page" id="page-templates" role="tabpanel">
            <div class="alert alert-info">
                <div class="alert-icon">&#x1F4DD;</div>
                <div class="alert-content">
                    <div class="alert-title">LIVING Templates</div>
                    <div class="alert-text">Templates marked with LIVING are specific additions to the standard META-SPRINT pack</div>
                </div>
            </div>
            <div class="template-card">
                <div class="template-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleTemplate(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="template-name">Update Protocol Template <span class="template-badge badge-living">LIVING</span></div>
                    <span>&#x25BC;</span>
                </div>
                <div class="template-body">
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">Lock at DoD-A-LIVING. Defines update strategy.</p>
                    <div class="form-row">
                        <label class="form-label">Update Frequency</label>
                        <input type="text" class="form-input" id="tpl-frequency" placeholder="e.g., Quarterly calendar + triggered">
                    </div>
                    <div class="form-row">
                        <label class="form-label">Trigger Conditions</label>
                        <textarea class="form-textarea" id="tpl-triggers" placeholder="List conditions that trigger immediate update..."></textarea>
                    </div>
                    <div class="form-row">
                        <label class="form-label">Stopping Criteria</label>
                        <textarea class="form-textarea" id="tpl-stopping" placeholder="Pre-specified criteria for stopping updates..."></textarea>
                    </div>
                    <button class="copy-btn" onclick="generateUpdateProtocol()">Generate and Copy</button>
                    <div class="template-output" id="tpl-update-output"></div>
                </div>
            </div>
            <div class="template-card">
                <div class="template-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleTemplate(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="template-name">Sustainability Plan Template <span class="template-badge badge-living">LIVING</span></div>
                    <span>&#x25BC;</span>
                </div>
                <div class="template-body">
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">Required for DoD-A-LIVING. Plans for long-term maintenance.</p>
                    <div class="form-row">
                        <label class="form-label">Core Team (with backup roles)</label>
                        <textarea class="form-textarea" id="tpl-team" placeholder="Name - Primary Role - Backup Role&#10;..."></textarea>
                    </div>
                    <div class="form-row">
                        <label class="form-label">Author Rotation Schedule</label>
                        <input type="text" class="form-input" id="tpl-rotation" placeholder="e.g., 6-month rotations with 2-month overlap">
                    </div>
                    <div class="form-row">
                        <label class="form-label">Funding Source and Duration</label>
                        <input type="text" class="form-input" id="tpl-funding" placeholder="e.g., Grant XYZ until 2027">
                    </div>
                    <button class="copy-btn" onclick="generateSustainabilityPlan()">Generate and Copy</button>
                    <div class="template-output" id="tpl-sustain-output"></div>
                </div>
            </div>
            <div class="template-card">
                <div class="template-header" tabindex="0" role="button" aria-expanded="false" onclick="toggleTemplate(this)" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();this.click()}">
                    <div class="template-name">Version Changelog Template <span class="template-badge badge-living">LIVING</span></div>
                    <span>&#x25BC;</span>
                </div>
                <div class="template-body">
                    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">Required for each update. Documents changes.</p>
                    <div class="form-row">
                        <label class="form-label">Version Number</label>
                        <input type="text" class="form-input" id="tpl-version" placeholder="e.g., v2.1">
                    </div>
                    <div class="form-row">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="tpl-date" aria-label="Update date">
                    </div>
                    <div class="form-row">
                        <label class="form-label">Studies Added</label>
                        <input type="number" class="form-input" id="tpl-added" placeholder="0">
                    </div>
                    <div class="form-row">
                        <label class="form-label">Conclusion Change</label>
                        <select class="form-input" id="tpl-conclusion">
                            <option value="unchanged">Conclusions unchanged</option>
                            <option value="strengthened">Conclusions strengthened</option>
                            <option value="weakened">Conclusions weakened</option>
                            <option value="reversed">Conclusions reversed</option>
                        </select>
                    </div>
                    <button class="copy-btn" onclick="generateChangelog()">Generate and Copy</button>
                    <div class="template-output" id="tpl-changelog-output"></div>
                </div>
            </div>
        </div>

        <!-- REFERENCE PAGE -->
        <div class="page" id="page-reference" role="tabpanel">
            <div class="card">
                <div class="card-header"><div class="card-title">LIVING-Specific Concepts</div></div>
                <div class="card-body">
                    <h4 style="margin-bottom:12px">Sequential Analysis Methods</h4>
                    <div style="background:var(--bg);padding:12px;border-radius:8px;font-size:13px;margin-bottom:16px">
                        In cumulative meta-analysis, repeated testing inflates Type I error. Sequential methods (Trial Sequential Analysis, alpha spending) control this by defining monitoring boundaries.
                    </div>
                    <h4 style="margin-bottom:12px">PRISMA-Living Extensions</h4>
                    <table class="ref-table">
                        <thead><tr><th>Item</th><th>LIVING Requirement</th></tr></thead>
                        <tbody>
                            <tr><td>Title</td><td>Identify as "living systematic review"</td></tr>
                            <tr><td>Methods</td><td>Update frequency, triggers, stopping criteria</td></tr>
                            <tr><td>Results</td><td>Update history, cumulative changes</td></tr>
                            <tr><td>Discussion</td><td>Next planned update date</td></tr>
                        </tbody>
                    </table>
                    <h4 style="margin:16px 0 12px">When to Consider Living Format</h4>
                    <div style="background:var(--success-light);padding:12px;border-radius:8px;font-size:13px;border:1px solid var(--success)">
                        <strong>Good candidates:</strong><br>
                        - Rapidly evolving evidence base<br>
                        - High-impact clinical questions<br>
                        - Priority topic for guideline organizations<br>
                        - Current uncertainty with ongoing trials
                    </div>
                    <div style="background:var(--danger-light);padding:12px;border-radius:8px;font-size:13px;border:1px solid var(--danger);margin-top:8px">
                        <strong>Poor candidates:</strong><br>
                        - Stable evidence base<br>
                        - Low-priority or niche topics<br>
                        - No ongoing research expected<br>
                        - Unable to secure long-term support
                    </div>
                </div>
            </div>
        </div>

        <!-- GLOSSARY PAGE -->
        <div class="page" id="page-glossary" role="tabpanel">
            <div class="card">
                <div class="card-header"><div class="card-title">LIVING Glossary</div></div>
                <div class="card-body" id="glossaryContent"></div>
            </div>
        </div>
    </div>
</div>

<!-- SETTINGS MODAL -->
<div class="modal" id="settingsModal" role="dialog" aria-modal="true">
    <div class="modal-card">
        <div class="modal-header">
            <div class="modal-title">Settings</div>
            <button class="modal-close" aria-label="Close" onclick="closeModal('settingsModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-row">
                <label class="form-label">Project Name</label>
                <input type="text" class="form-input" id="projectNameInput" placeholder="My LIVING Project">
            </div>
            <div class="btn-row" style="margin-top:16px">
                <button class="copy-btn" onclick="exportData()">Export Data</button>
                <button class="download-btn" onclick="resetData()">Reset All</button>
            </div>
        </div>
    </div>
</div>

<script>
// STATE
let state = {
    day: 1,
    role: '',
    bootcamp: {},
    updateConfig: {},
    alertChecks: {},
    tasks: {},
    taskAssignees: {},
    dodChecked: {},
    dodGates: { A: false, B: false, C: false, D: false, E: false },
    studyCount: 0,
    updateCount: 0,
    storiesRead: {},
    versionHistory: '',
    prismaFlow: {}
};

// CONSTANTS
const ROLE_NAMES = {
    integrator: 'Integrator',
    deputy: 'Deputy',
    alerts: 'Alert Monitoring',
    extraction: 'Rapid Extraction',
    analysis: 'Analysis Pod',
    write: 'Write Pod'
};

const PHASES = [
    { id: 'A', name: 'Protocol Lock', days: [1, 4], cls: 'phase-a' },
    { id: 'B', name: 'Search Lock', days: [6, 12], cls: 'phase-b' },
    { id: 'C', name: 'Extraction Lock', days: [12, 28], cls: 'phase-c' },
    { id: 'D', name: 'Analysis Lock', days: [24, 34], cls: 'phase-d' },
    { id: 'E', name: 'Submission Lock', days: [34, 40], cls: 'phase-e' }
];

const DOD_CHECKLISTS = {
    A: [
        { id: 'a1', text: 'Living review justification documented (rapid evidence base, high impact)' },
        { id: 'a2', text: 'Update frequency defined (monthly, quarterly, triggered)' },
        { id: 'a3', text: 'Update triggers specified (new RCT, safety signal, guideline request)' },
        { id: 'a4', text: 'Stopping criteria defined (evidence stable, question answered, resources)' },
        { id: 'a5', text: 'Version control system established' },
        { id: 'a6', text: 'Author rotation/sustainability plan documented' },
        { id: 'a7', text: 'PICOS and primary outcome defined' },
        { id: 'a8', text: 'Study plan registered (PROSPERO/protocols.io)' },
        { id: 'a9', text: 'Signed by Integrator + non-integrator' }
    ],
    B: [
        { id: 'b1', text: 'Automated search alerts configured for all databases' },
        { id: 'b2', text: 'Preprint servers included (medRxiv, bioRxiv)' },
        { id: 'b3', text: 'Trial registries monitored for results posting' },
        { id: 'b4', text: 'RSS feeds and table-of-contents alerts active' },
        { id: 'b5', text: 'Search strings saved verbatim with dates' },
        { id: 'b6', text: 'Baseline studies identified and screened' },
        { id: 'b7', text: 'Alert review workflow tested' }
    ],
    C: [
        { id: 'c1', text: 'Rapid extraction workflow established' },
        { id: 'c2', text: 'Pre-extracted forms for anticipated study types created' },
        { id: 'c3', text: 'Quality check process for rapid extraction documented' },
        { id: 'c4', text: 'Integration with existing dataset documented' },
        { id: 'c5', text: 'Baseline extraction complete' },
        { id: 'c6', text: 'Risk of bias assessment complete' },
        { id: 'c7', text: 'Audit 1 (10% trace) passed' }
    ],
    D: [
        { id: 'd1', text: 'Cumulative meta-analysis approach defined' },
        { id: 'd2', text: 'Sequential analysis boundaries set (if applicable)' },
        { id: 'd3', text: 'New evidence integration workflow tested' },
        { id: 'd4', text: 'Dashboard for real-time results created (if public)' },
        { id: 'd5', text: 'Baseline analysis complete' },
        { id: 'd6', text: 'GRADE/certainty assessment complete' },
        { id: 'd7', text: 'Audit 2 passed' }
    ],
    E: [
        { id: 'e1', text: 'Living review declaration in title/abstract' },
        { id: 'e2', text: 'Update history and changelog complete' },
        { id: 'e3', text: 'Next planned update date stated' },
        { id: 'e4', text: 'PRISMA-Living checklist addressed' },
        { id: 'e5', text: 'Archival of superseded versions complete' },
        { id: 'e6', text: 'Submission pack ready' }
    ]
};

const GLOSSARY = [
    { term: 'Living systematic review', plain: 'A systematic review that is continually updated, incorporating relevant new evidence as it becomes available.', technical: 'Defined by Elliott et al. as "a systematic review which is continually updated, incorporating relevant new evidence as it becomes available."' },
    { term: 'Update trigger', plain: 'A pre-specified condition that initiates a review update, such as a new RCT or safety signal.', technical: 'Can be time-based (calendar), event-based, or hybrid. Should be defined in protocol.' },
    { term: 'Stopping criterion', plain: 'Pre-specified conditions for when to stop updating the living review.', technical: 'Examples: evidence stability for N updates, information size reached, question no longer relevant.' },
    { term: 'Sequential analysis', plain: 'Statistical methods that control for multiple testing when repeatedly analyzing accumulating data.', technical: 'Includes Trial Sequential Analysis (TSA) and alpha-spending approaches to maintain overall Type I error.' },
    { term: 'Cumulative meta-analysis', plain: 'A meta-analysis that is updated each time a new study is added, showing how the pooled estimate evolves.', technical: 'Useful for detecting when evidence becomes stable or when conclusions change.' },
    { term: 'Alpha spending', plain: 'A method for distributing the overall significance level across multiple interim analyses.', technical: 'Functions like O Brien-Fleming or Pocock boundaries control cumulative Type I error.' },
    { term: 'Preprint', plain: 'A version of a scientific paper before peer review, often posted on servers like medRxiv or bioRxiv.', technical: 'Important for living reviews to capture emerging evidence quickly, but requires caution in interpretation.' },
    { term: 'Trial registry monitoring', plain: 'Watching clinical trial registries for new registrations and results postings.', technical: 'Key registries include ClinicalTrials.gov, ISRCTN, EU-CTR, WHO ICTRP.' },
    { term: 'Automated search alerts', plain: 'Email notifications when new records match saved search strategies.', technical: 'Available in PubMed, Embase, Cochrane CENTRAL, and most major databases.' },
    { term: 'Version control', plain: 'Systematic tracking of changes between review versions, including what changed and why.', technical: 'Should include dated versions, changelog, and archived superseded versions.' },
    { term: 'Changelog', plain: 'A record of all changes made in each update, including studies added and conclusion changes.', technical: 'Essential for transparency and reproducibility in living reviews.' },
    { term: 'Superseded version', plain: 'A previous version of the review that has been replaced by an update.', technical: 'Should be archived and accessible, clearly marked as superseded.' },
    { term: 'Living evidence', plain: 'Evidence that continues to evolve as new research is published.', technical: 'Characteristic of active research areas where living review format is most appropriate.' },
    { term: 'Update frequency', plain: 'How often the review is updated (monthly, quarterly, triggered, or hybrid).', technical: 'Should be pre-specified based on expected evidence flow and resources.' },
    { term: 'Sustainability plan', plain: 'Documentation of how the living review will be maintained long-term.', technical: 'Includes team rotation, funding, documentation, and succession planning.' },
    { term: 'Author rotation', plain: 'Planned turnover of team members to prevent burnout and ensure continuity.', technical: 'Typically involves overlapping rotations with knowledge transfer periods.' },
    { term: 'Information size', plain: 'The amount of information (participants/events) needed to detect a clinically important effect.', technical: 'Analogous to sample size in a single trial. Used in TSA to determine when sufficient evidence exists.' },
    { term: 'PRISMA-Living', plain: 'Extensions to the PRISMA reporting guideline specific to living systematic reviews.', technical: 'Includes items for update strategy, version history, and next update planning.' }
];

const DAILY_GOALS = {
    1: 'Complete Bootcamp + Define Update Strategy',
    2: 'Finalize PICOS + Stopping Criteria',
    3: 'Configure search alerts',
    4: 'Sign off DoD-A-LIVING',
    6: 'Execute baseline searches',
    10: 'Complete screening + Test alert workflow',
    12: 'Sign off DoD-B-LIVING',
    18: 'Audit 1 begins',
    20: 'Audit 1 complete',
    28: 'Sign off DoD-C-LIVING',
    30: 'Run cumulative meta-analysis',
    32: 'Audit 2 begins',
    34: 'Sign off DoD-D-LIVING',
    40: 'Submit! DoD-E-LIVING complete'
};

// INITIALIZATION
document.addEventListener('DOMContentLoaded', function() {
    loadState();
    if (state.role) {
        document.getElementById('onboarding').classList.add('hidden');
        document.getElementById('app').style.display = 'block';
        render();
    }
    loadDarkMode();
});

function loadState() {
    var saved = localStorage.getItem('metasprint-living');
    if (saved) {
        try {
            var data = JSON.parse(saved);
            delete data.__proto__; delete data.constructor; delete data.prototype;
            state = Object.assign({}, state, data);
        } catch(e) {}
    }
}

function save() {
    try { localStorage.setItem('metasprint-living', JSON.stringify(state)); }
    catch(e) { if (e.name === 'QuotaExceededError') showToast('Storage full — export your data to free space', 'error'); }
}

// ONBOARDING
function toggleElig(el) {
    el.classList.toggle('checked');
    var allChecked = document.querySelectorAll('.elig-item.checked').length === document.querySelectorAll('.elig-item').length;
    document.getElementById('nextBtn1').disabled = !allChecked;
}

function goToStep2() {
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
}

function selectRole(el, role) {
    document.querySelectorAll('.role-btn').forEach(function(b) { b.classList.remove('selected'); });
    el.classList.add('selected');
    state.role = role;
    document.getElementById('startBtn').disabled = false;
}

function startApp() {
    save();
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('app').style.display = 'block';
    render();
}

function showRoleChange() {
    document.getElementById('step1').style.display = 'none';
    document.getElementById('step2').style.display = 'block';
    document.getElementById('onboarding').classList.remove('hidden');
}

// RENDER
function buildRiskState() {
    var d = state.day;
    var gates = state.dodGates || {};
    var studyCount = state.studyCount ?? 0;
    var daysToFreeze = Math.max(0, 34 - d);
    var risks = [];
    var points = 0;
    var gateDeadlines = { A: 4, B: 12, C: 28, D: 34, E: 40 };

    ['A', 'B', 'C', 'D', 'E'].forEach(function(gate) {
        var deadline = gateDeadlines[gate];
        if (d > deadline && !gates[gate]) {
            var overdue = d - deadline;
            risks.push({ level: 'high', text: 'DoD-' + gate + ' overdue by ' + overdue + ' day(s).' });
            points += 3;
        }
    });

    if (d < 34 && daysToFreeze <= 3 && !gates.D) {
        risks.push({ level: 'medium', text: 'Freeze in ' + daysToFreeze + ' day(s), but DoD-D is not signed off.' });
        points += 2;
    }

    if (studyCount > 0 && (studyCount < 40 || studyCount > 60)) {
        risks.push({ level: 'medium', text: 'Study count ' + studyCount + ' is outside target range (40-60).' });
        points += 1;
    } else if (d > 12 && studyCount === 0) {
        risks.push({ level: 'medium', text: 'Study count is still zero after Day 12. Verify PRISMA and extraction logs.' });
        points += 1;
    }

    var level = 'low';
    if (points >= 4) level = 'high';
    else if (points >= 2) level = 'medium';

    if (risks.length === 0) {
        risks.push({ level: 'low', text: 'No active risks. Keep daily outputs on schedule.' });
    }

    return { level: level, items: risks };
}

function renderRiskPanel() {
    var badge = document.getElementById('riskStatusBadge');
    var list = document.getElementById('riskList');
    if (!badge || !list) return;

    var risk = buildRiskState();
    badge.className = 'risk-badge ' + risk.level;
    badge.textContent = risk.level.toUpperCase();

    var html = '';
    risk.items.forEach(function(item) {
        var cls = 'risk-item';
        if (item.level === 'high') cls += ' high';
        else if (item.level === 'medium') cls += ' medium';
        html += '<li class="' + cls + '">' + escapeHtml(item.text) + '</li>';
    });
    list.innerHTML = html;
}

function render() {
    var d = state.day;
    document.getElementById('dayNum').textContent = d;
    document.getElementById('prevDayBtn').disabled = d <= 1;
    document.getElementById('nextDayBtn').disabled = d >= 40;
    document.getElementById('roleBadge').textContent = ROLE_NAMES[state.role] || state.role;
    document.getElementById('freezeBanner').classList.toggle('hidden', d < 34);
    document.getElementById('timelineFill').style.width = ((d / 40) * 100) + '%';
    var timelineBar = document.getElementById('timelineBar');
    if (timelineBar) timelineBar.setAttribute('aria-valuenow', d);
    var phase = PHASES.find(function(p) { return d >= p.days[0] && d <= p.days[1]; }) || PHASES[0];
    var badge = document.getElementById('phaseBadge');
    badge.textContent = phase.name;
    badge.className = 'phase-badge ' + phase.cls;
    document.getElementById('daysRemaining').textContent = 40 - d;
    document.getElementById('updateCount').textContent = state.updateCount ?? 0;
    document.getElementById('studyCount').textContent = state.studyCount ?? 0;
    var gatesPassed = ['A','B','C','D','E'].filter(function(g) { return state.dodGates[g]; }).length;
    document.getElementById('gatesPassed').textContent = gatesPassed + '/5';
    ['A','B','C','D','E'].forEach(function(g) {
        var dot = document.getElementById('gate' + g);
        dot.classList.remove('passed', 'current');
        if (state.dodGates[g]) dot.classList.add('passed');
    });
    var score = 100;
    if (d > 4 && !state.dodGates.A) score -= 20;
    if (d > 12 && !state.dodGates.B) score -= 20;
    if (d > 28 && !state.dodGates.C) score -= 20;
    if (d > 34 && !state.dodGates.D) score -= 20;
    score = Math.max(0, score);
    var scoreEl = document.getElementById('healthScore');
    scoreEl.textContent = score + '%';
    scoreEl.className = 'health-score ' + (score >= 80 ? 'good' : score >= 50 ? 'warning' : 'danger');

    renderRiskPanel();
    document.getElementById('bootcampCard').style.display = d <= 2 ? 'block' : 'none';
    var goal = DAILY_GOALS[d] || 'Continue current phase tasks';
    document.getElementById('goalText').textContent = goal;
    renderTasks();
    renderDoD();
    renderGlossary();
    renderDeadlineAlerts();
}

function renderTasks() {
    var d = state.day;
    var tasks = [];
    if (d === 1) {
        tasks = [
            { text: 'Complete LIVING Bootcamp (45 min)', owner: 'All' },
            { text: 'Define update frequency and triggers', owner: 'Integrator' },
            { text: 'Draft sustainability plan', owner: 'Integrator' }
        ];
    } else if (d <= 4) {
        tasks = [
            { text: 'Finalize stopping criteria', owner: 'Integrator' },
            { text: 'Set up version control system', owner: 'Deputy' },
            { text: 'Document author rotation schedule', owner: 'Integrator' }
        ];
    } else if (d <= 12) {
        tasks = [
            { text: 'Configure automated search alerts', owner: 'Alert Pod' },
            { text: 'Set up preprint monitoring', owner: 'Alert Pod' },
            { text: 'Test alert review workflow', owner: 'Alert Pod' }
        ];
    } else if (d <= 28) {
        tasks = [
            { text: 'Continue data extraction', owner: 'Extraction' },
            { text: 'Test rapid extraction workflow', owner: 'Extraction' },
            { text: 'Prepare for Audit 1', owner: 'Deputy' }
        ];
    } else if (d <= 34) {
        tasks = [
            { text: 'Run cumulative meta-analysis', owner: 'Analysis' },
            { text: 'Set sequential analysis boundaries', owner: 'Analysis' },
            { text: 'Create update dashboard', owner: 'Analysis' }
        ];
    } else {
        tasks = [
            { text: 'Final manuscript review', owner: 'Integrator' },
            { text: 'Complete PRISMA-Living checklist', owner: 'Integrator' },
            { text: 'Archive baseline version', owner: 'Write Pod' }
        ];
    }
    var html = '';
    tasks.forEach(function(task, i) {
        var key = d + '-' + i;
        var checked = state.tasks[key];
        var assignee = (state.taskAssignees && state.taskAssignees[key]) || task.owner || '';
        var safeAssignee = escapeHtml(assignee);
        html += '<div class="checklist-item ' + (checked ? 'checked' : '') + '" style="position:relative">' +
            '<div class="check-box" onclick="toggleTask(\'' + key + '\')"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>' +
            '<div class="checklist-content" onclick="toggleTask(\'' + key + '\')" style="flex:1">' +
            '<div class="checklist-title">' + task.text + '</div></div>' +
            '<input type="text" value="' + safeAssignee + '" placeholder="Owner" onclick="event.stopPropagation()" onchange="setTaskAssignee(\'' + key + '\', this.value)" style="width:70px;padding:4px 6px;border:1px solid var(--border);border-radius:4px;font-size:11px;text-align:center;background:var(--bg)">' +
            '</div>';
    });
    document.getElementById('tasksContainer').innerHTML = html;
}

function setTaskAssignee(key, value) {
    if (!state.taskAssignees) state.taskAssignees = {};
    state.taskAssignees[key] = value;
    save();
    showToast('Assignee updated');
}

function toggleTask(key) {
    state.tasks[key] = !state.tasks[key];
    save();
    renderTasks();
    showToast('Saved');
}

function renderDoD() {
    var html = '';
    PHASES.forEach(function(phase) {
        var items = DOD_CHECKLISTS[phase.id] || [];
        var checkedCount = items.filter(function(item) { return state.dodChecked[item.id]; }).length;
        var allChecked = checkedCount === items.length;
        var passed = state.dodGates[phase.id];
        var statusText = passed ? 'PASSED' : allChecked ? 'Ready' : checkedCount + '/' + items.length;
        var statusClass = passed ? 'gate-passed' : allChecked ? 'gate-ready' : 'gate-pending';
        html += '<div class="dod-section"><div class="dod-header ' + phase.cls + '">' +
            '<div class="dod-title">DoD-' + phase.id + '-LIVING: ' + phase.name + '</div>' +
            '<div class="dod-gate-status ' + statusClass + '">' + statusText + '</div></div>';
        items.forEach(function(item) {
            var checked = state.dodChecked[item.id];
            html += '<div class="checklist-item ' + (checked ? 'checked' : '') + '" onclick="toggleDoD(\'' + item.id + '\')">' +
                '<div class="check-box"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M20 6L9 17l-5-5"/></svg></div>' +
                '<div class="checklist-content"><div class="checklist-title">' + escapeHtml(item.text) + '</div></div></div>';
        });
        if (allChecked && !passed) {
            html += '<button class="copy-btn" style="width:100%;margin-top:12px" onclick="signOffGate(\'' + phase.id + '\')">Sign Off DoD-' + phase.id + '-LIVING</button>';
        }
        html += '</div>';
    });
    document.getElementById('dodContainer').innerHTML = html;
}

function toggleDoD(id) {
    state.dodChecked[id] = !state.dodChecked[id];
    save();
    renderDoD();
    showToast('Saved');
}

function signOffGate(gateId) {
    if (!confirm('Sign off DoD-' + gateId + '-LIVING? This confirms all checklist items are complete.')) return;
    state.dodGates[gateId] = true;
    save();
    render();
    showToast('DoD-' + gateId + '-LIVING PASSED!');
    launchConfetti();
}

function renderGlossary() {
    var html = '';
    GLOSSARY.forEach(function(item) {
        html += '<div style="margin-bottom:16px;padding-bottom:16px;border-bottom:1px solid var(--border)">' +
            '<div style="font-weight:700;color:var(--living)">' + escapeHtml(item.term) + '</div>' +
            '<div style="margin-top:4px">' + escapeHtml(item.plain) + '</div>' +
            '<div style="font-size:12px;color:var(--text-muted);margin-top:4px;font-style:italic">' + escapeHtml(item.technical) + '</div></div>';
    });
    document.getElementById('glossaryContent').innerHTML = html;
}

function renderDeadlineAlerts() {
    var d = state.day;
    var alerts = [];
    if (d <= 4 && !state.dodGates.A) {
        var daysLeft = 4 - d;
        if (daysLeft <= 2) {
            alerts.push({ type: daysLeft === 0 ? 'danger' : 'warning', title: 'DoD-A-LIVING due ' + (daysLeft === 0 ? 'TODAY' : 'in ' + daysLeft + ' day(s)'), text: 'Protocol + Update strategy + Sustainability plan must be locked' });
        }
    }
    if (d > 4 && d <= 12 && !state.dodGates.B) {
        var daysLeft = 12 - d;
        if (daysLeft <= 3) {
            alerts.push({ type: daysLeft === 0 ? 'danger' : 'warning', title: 'DoD-B-LIVING due ' + (daysLeft === 0 ? 'TODAY' : 'in ' + daysLeft + ' day(s)'), text: 'Search + Alerts configured' });
        }
    }
    if (alerts.length === 0 && d <= 40) {
        var nextGate = !state.dodGates.A ? 'A' : !state.dodGates.B ? 'B' : !state.dodGates.C ? 'C' : !state.dodGates.D ? 'D' : 'E';
        alerts.push({ type: 'success', title: 'On track', text: 'Next milestone: DoD-' + nextGate + '-LIVING' });
    }
    var html = '';
    alerts.forEach(function(a) {
        html += '<div class="alert alert-' + a.type + '" style="margin-bottom:8px"><div class="alert-content"><div class="alert-title">' + a.title + '</div><div class="alert-text">' + a.text + '</div></div></div>';
    });
    document.getElementById('deadlineAlerts').innerHTML = html;
}

// NAVIGATION
function changeDay(delta) {
    state.day = Math.max(1, Math.min(40, state.day + delta));
    save();
    render();
}

const MORE_TAB_PAGES = ['stories', 'reference', 'glossary'];

function toggleMoreTabs(event) {
    event.stopPropagation();
    var dropdown = document.getElementById('moreTabsDropdown');
    var btn = dropdown.previousElementSibling;
    var isOpen = dropdown.classList.contains('visible');
    dropdown.classList.toggle('visible', !isOpen);
    btn.setAttribute('aria-expanded', !isOpen);
    if (!isOpen) {
        var firstItem = dropdown.querySelector('.tab-more-item');
        if (firstItem) firstItem.focus();
        document.addEventListener('click', closeMoreTabsOnOutsideClick);
        document.addEventListener('keydown', handleMoreTabsKeyboard);
    } else {
        document.removeEventListener('click', closeMoreTabsOnOutsideClick);
        document.removeEventListener('keydown', handleMoreTabsKeyboard);
    }
}

function closeMoreTabsOnOutsideClick(e) {
    var wrapper = document.querySelector('.tab-more-wrapper');
    if (!wrapper.contains(e.target)) closeMoreDropdown();
}

function handleMoreTabsKeyboard(e) {
    var dropdown = document.getElementById('moreTabsDropdown');
    if (!dropdown.classList.contains('visible')) return;
    var items = Array.from(dropdown.querySelectorAll('.tab-more-item'));
    var idx = items.indexOf(document.activeElement);
    if (e.key === 'Escape') { closeMoreDropdown(); dropdown.previousElementSibling.focus(); e.preventDefault(); }
    else if (e.key === 'ArrowDown') { e.preventDefault(); items[Math.min(idx + 1, items.length - 1)].focus(); }
    else if (e.key === 'ArrowUp') { e.preventDefault(); items[Math.max(idx - 1, 0)].focus(); }
}

function closeMoreDropdown() {
    var dropdown = document.getElementById('moreTabsDropdown');
    if (dropdown) {
        dropdown.classList.remove('visible');
        dropdown.previousElementSibling.setAttribute('aria-expanded', 'false');
    }
    document.removeEventListener('click', closeMoreTabsOnOutsideClick);
    document.removeEventListener('keydown', handleMoreTabsKeyboard);
}

function showPageFromMore(pageId, clickedItem) {
    closeMoreDropdown();
    document.querySelectorAll('.tab-more-item').forEach(function(i) { i.classList.remove('active'); });
    if (clickedItem) clickedItem.classList.add('active');
    var moreBtn = document.querySelector('.tab-more-btn');
    if (moreBtn) moreBtn.classList.add('has-active');
    showPage(pageId, null);
}

function showPage(pageId, btn) {
    document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
    document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); t.setAttribute('aria-selected', 'false'); });

    // Close More dropdown and clear its active states
    closeMoreDropdown();
    document.querySelectorAll('.tab-more-item').forEach(function(i) { i.classList.remove('active'); });
    var moreBtn = document.querySelector('.tab-more-btn');
    if (moreBtn) moreBtn.classList.remove('has-active');

    if (MORE_TAB_PAGES.indexOf(pageId) !== -1) {
        var item = document.querySelector('.tab-more-item[data-page="' + pageId + '"]');
        if (item) item.classList.add('active');
        if (moreBtn) moreBtn.classList.add('has-active');
    } else if (btn && btn.classList) {
        btn.classList.add('active');
        btn.setAttribute('aria-selected', 'true');
    }

    document.getElementById('page-' + pageId).classList.add('active');
}

function showDayJump() {
    document.getElementById('dayJumpModal').classList.add('visible');
    var input = document.getElementById('dayJumpInput');
    input.value = state.day;
    input.select();
}

function closeDayJump(e) {
    if (e && e.target !== e.currentTarget) return;
    document.getElementById('dayJumpModal').classList.remove('visible');
}

function jumpToDay() {
    var val = parseInt(document.getElementById('dayJumpInput').value, 10) ?? 1;
    state.day = Math.max(1, Math.min(40, val));
    save();
    render();
    closeDayJump();
    showToast('Jumped to Day ' + state.day);
}

function handleDayJumpKey(e) {
    if (e.key === 'Enter') jumpToDay();
    else if (e.key === 'Escape') closeDayJump();
}

// BOOTCAMP
var currentLesson = 0;
var lessons = ['fundamentals', 'triggers', 'automation', 'sequential', 'sustainability'];

function toggleBootcamp(el, module) {
    el.classList.toggle('completed');
    state.bootcamp[module] = el.classList.contains('completed');
    save();
    openBootcampLesson(module);
}

function openBootcampLesson(module) {
    var idx = lessons.indexOf(module);
    if (idx >= 0) currentLesson = idx;
    showLesson();
    openModal('bootcampModal');
}

function showLesson() {
    lessons.forEach(function(l, i) {
        var el = document.getElementById('lesson-' + l);
        if (el) el.style.display = i === currentLesson ? 'block' : 'none';
    });
    document.getElementById('lessonCounter').textContent = (currentLesson + 1) + ' / ' + lessons.length;
    document.getElementById('prevLessonBtn').disabled = currentLesson === 0;
    document.getElementById('nextLessonBtn').textContent = currentLesson === lessons.length - 1 ? 'Finish' : 'Next';
}

function nextLesson() {
    if (currentLesson < lessons.length - 1) {
        currentLesson++;
        showLesson();
    } else {
        closeModal('bootcampModal');
        showToast('Bootcamp complete!');
    }
}

function prevLesson() {
    if (currentLesson > 0) {
        currentLesson--;
        showLesson();
    }
}

// DARK MODE
function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    var isDark = document.body.classList.contains('dark-mode');
    try { localStorage.setItem('metasprint_living_dark', isDark ? 'true' : 'false'); } catch(e) {}
    document.getElementById('darkModeBtn').textContent = isDark ? '\u2600' : '\u{1F319}';
}

function loadDarkMode() {
    if (localStorage.getItem('metasprint_living_dark') === 'true') {
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeBtn').textContent = '\u2600';
    }
}

// MODALS
var _savedFocus = null;
function openModal(id) {
    _savedFocus = document.activeElement;
    document.getElementById(id).classList.add('visible');
}
function closeModal(id) {
    document.getElementById(id).classList.remove('visible');
    if (_savedFocus) { try { _savedFocus.focus(); } catch(e) {} _savedFocus = null; }
}

// TEMPLATES
function toggleTemplate(el) {
    var body = el.nextElementSibling;
    body.classList.toggle('open');
    el.setAttribute('aria-expanded', body.classList.contains('open') ? 'true' : 'false');
}

function showOutput(id, text) {
    var el = document.getElementById(id);
    el.textContent = text;
    el.classList.add('visible');
    navigator.clipboard.writeText(text).then(function() {
        showToast('Copied to clipboard');
    }).catch(function() {
        showToast('Output ready (clipboard unavailable)');
    });
}

function generateUpdateProtocol() {
    var text = 'UPDATE PROTOCOL (LIVING)\n=====================================\n' +
        'Frequency: ' + (document.getElementById('tpl-frequency').value || 'Not specified') + '\n' +
        'Triggers: ' + (document.getElementById('tpl-triggers').value || 'Not specified') + '\n' +
        'Stopping Criteria: ' + (document.getElementById('tpl-stopping').value || 'Not specified') + '\n\n' +
        'LOCKED at DoD-A-LIVING.';
    showOutput('tpl-update-output', text);
}

function generateSustainabilityPlan() {
    var text = 'SUSTAINABILITY PLAN (LIVING)\n=====================================\n' +
        'Team:\n' + (document.getElementById('tpl-team').value || 'Not specified') + '\n\n' +
        'Rotation Schedule: ' + (document.getElementById('tpl-rotation').value || 'Not specified') + '\n' +
        'Funding: ' + (document.getElementById('tpl-funding').value || 'Not specified');
    showOutput('tpl-sustain-output', text);
}

function generateChangelog() {
    var text = 'VERSION CHANGELOG\n=====================================\n' +
        'Version: ' + (document.getElementById('tpl-version').value || 'v?.?') + '\n' +
        'Date: ' + (document.getElementById('tpl-date').value || 'Not specified') + '\n' +
        'Studies Added: ' + (document.getElementById('tpl-added').value || '0') + '\n' +
        'Conclusion: ' + (document.getElementById('tpl-conclusion').value || 'Not specified');
    showOutput('tpl-changelog-output', text);
}

// UTILITIES
function showToast(msg) {
    var toast = document.getElementById('toast');
    document.getElementById('toastText').textContent = msg;
    toast.classList.add('visible');
    setTimeout(function() { toast.classList.remove('visible'); }, 2500);
}

function launchConfetti() {
    var container = document.getElementById('confettiContainer');
    var colors = ['#10B981', '#059669', '#D97706', '#DC2626', '#7C3AED'];
    for (var i = 0; i < 80; i++) {
        var c = document.createElement('div');
        c.className = 'confetti';
        c.style.left = Math.random() * 100 + '%';
        c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        c.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(c);
    }
    setTimeout(function() { container.innerHTML = ''; }, 4000);
}

function exportData() {
    var blob = new Blob([JSON.stringify(state, null, 2)], { type: 'application/json' });
    var a = document.createElement('a');
    var url = URL.createObjectURL(blob);
    a.href = url;
    a.download = 'metasprint-living-backup.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function escapeHtml(str) {
    if (typeof str !== 'string') return '';
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function resetData() {
    if (!confirm('Reset all data? This cannot be undone.')) return;
    localStorage.removeItem('metasprint-living');
    location.reload();
}

// ALERTS
function toggleAlert(el, alertType) {
    el.classList.toggle('checked');
    if (!state.alertChecks) state.alertChecks = {};
    state.alertChecks[alertType] = el.classList.contains('checked');
    save();
}

// PRISMA
function validatePrisma() {
    var identified = parseInt(document.getElementById('prismaIdentified').value, 10) ?? 0;
    var duplicates = parseInt(document.getElementById('prismaDuplicates').value, 10) ?? 0;
    var screened = parseInt(document.getElementById('prismaScreened').value, 10) ?? 0;
    var excluded = parseInt(document.getElementById('prismaExcluded').value, 10) ?? 0;
    var fullText = parseInt(document.getElementById('prismaFullText').value, 10) ?? 0;
    var included = parseInt(document.getElementById('prismaIncluded').value, 10) ?? 0;
    var warningEl = document.getElementById('prismaWarning');
    if (!warningEl) return;
    var warnings = [];
    if (identified > 0 && screened > identified - duplicates) {
        warnings.push('Screened should be <= Identified - Duplicates');
    }
    if (screened > 0 && fullText > screened - excluded) {
        warnings.push('Full-text should be <= Screened - Excluded');
    }
    if (included > fullText) {
        warnings.push('Included cannot exceed Full-text');
    }
    if (warnings.length > 0) {
        warningEl.innerHTML = warnings.map(function(w) { return escapeHtml(w); }).join('<br>');
        warningEl.classList.add('visible');
        warningEl.classList.remove('prisma-valid');
    } else if (included > 0) {
        warningEl.innerHTML = 'PRISMA numbers validated';
        warningEl.classList.add('visible', 'prisma-valid');
    } else {
        warningEl.classList.remove('visible');
    }
}

function savePrismaFlow() {
    state.prismaFlow = {
        identified: parseInt(document.getElementById('prismaIdentified').value, 10) ?? 0,
        duplicates: parseInt(document.getElementById('prismaDuplicates').value, 10) ?? 0,
        screened: parseInt(document.getElementById('prismaScreened').value, 10) ?? 0,
        excluded: parseInt(document.getElementById('prismaExcluded').value, 10) ?? 0,
        fullText: parseInt(document.getElementById('prismaFullText').value, 10) ?? 0,
        included: parseInt(document.getElementById('prismaIncluded').value, 10) ?? 0
    };
    state.studyCount = state.prismaFlow.included ?? 0;
    var studyEl = document.getElementById('studyCount');
    if (studyEl) studyEl.textContent = state.studyCount;
    save();
}

function updateStudyCount() {
    var included = parseInt(document.getElementById('prismaIncluded').value, 10) ?? 0;
    if (included > 0) {
        state.studyCount = included;
        save();
        var el = document.getElementById('studyCount');
        if (el) el.textContent = included;
    }
}

function promptStudyCount() {
    var current = state.studyCount ?? 0;
    var input = prompt('Enter number of included studies:', current);
    if (input !== null && !isNaN(parseInt(input))) {
        state.studyCount = parseInt(input);
        save();
        render();
        showToast('Study count updated');
    }
}

function saveUpdateConfig() {
    state.updateConfig = {
        frequency: document.getElementById('updateFrequency').value,
        triggers: {
            rct: document.getElementById('trigger-rct').checked,
            safety: document.getElementById('trigger-safety').checked,
            guideline: document.getElementById('trigger-guideline').checked,
            threshold: document.getElementById('trigger-threshold').checked,
            major: document.getElementById('trigger-major').checked
        },
        stoppingCriteria: document.getElementById('stoppingCriteria').value
    };
    save();
    showToast('Update configuration saved');
}

function saveVersionHistory() {
    state.versionHistory = document.getElementById('versionHistory').value;
    save();
    showToast('Version history saved');
}

// STORIES
function toggleStory(header) {
    var body = header.nextElementSibling;
    body.classList.toggle('open');
    header.setAttribute('aria-expanded', body.classList.contains('open') ? 'true' : 'false');
    var storyNum = header.querySelector('.story-number').textContent;
    if (!state.storiesRead) state.storiesRead = {};
    state.storiesRead[storyNum] = true;
    save();
}

// STANDUP
function openStandupModal() {
    generateStandup();
    document.getElementById('standupModal').classList.add('open');
}

function closeStandupModal(e) {
    if (!e || e.target === e.currentTarget) {
        document.getElementById('standupModal').classList.remove('open');
    }
}

function generateStandup() {
    var day = state.day ?? 1;
    var yesterday = day > 1 ? ['Previous tasks completed'] : ['Day 1 - Project kickoff'];
    var today = [DAILY_GOALS[day] || 'Continue current phase tasks'];
    var blockers = ['No blockers'];
    document.getElementById('standupYesterday').innerHTML = yesterday.map(function(t) { return '<div class="standup-item">' + escapeHtml(t) + '</div>'; }).join('');
    document.getElementById('standupToday').innerHTML = today.map(function(t) { return '<div class="standup-item">' + escapeHtml(t) + '</div>'; }).join('');
    document.getElementById('standupBlockers').innerHTML = blockers.map(function(t) { return '<div class="standup-item">' + escapeHtml(t) + '</div>'; }).join('');
    var gatesPassed = ['A','B','C','D','E'].filter(function(g) { return state.dodGates[g]; }).length;
    document.getElementById('standupStatus').innerHTML = '<div class="standup-item">Day ' + day + '/40 (' + (40-day) + ' days remaining)</div><div class="standup-item">' + (state.studyCount ?? 0) + ' studies | ' + gatesPassed + '/5 gates passed</div>';
}

function copyStandup() {
    var day = state.day ?? 1;
    var text = 'META-SPRINT LIVING Standup - Day ' + day + '\n\n' +
        'YESTERDAY:\n' + document.getElementById('standupYesterday').innerText + '\n\n' +
        'TODAY:\n' + document.getElementById('standupToday').innerText + '\n\n' +
        'BLOCKERS:\n' + document.getElementById('standupBlockers').innerText + '\n\n' +
        'STATUS:\n' + document.getElementById('standupStatus').innerText;
    navigator.clipboard.writeText(text).then(function() {
        showToast('Standup copied to clipboard!');
        closeStandupModal();
    }).catch(function() {
        showToast('Standup generated (clipboard unavailable)');
        closeStandupModal();
    });
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        var visibleModal = document.querySelector('.modal.visible');
        if (visibleModal) { closeModal(visibleModal.id); e.preventDefault(); return; }
        var dayJump = document.getElementById('dayJumpModal');
        if (dayJump && dayJump.classList.contains('visible')) { closeDayJump(); e.preventDefault(); return; }
        var standup = document.getElementById('standupModal');
        if (standup && standup.classList.contains('open')) { closeStandupModal(); e.preventDefault(); return; }
        return;
    }
    if (document.getElementById('app').style.display === 'none') return;
    if (['INPUT', 'TEXTAREA', 'SELECT'].includes(e.target.tagName)) return;
    if (document.querySelector('.modal.visible, .day-jump-modal.visible, .standup-modal.open')) return;
    if (e.key === 'ArrowLeft') { changeDay(-1); e.preventDefault(); }
    else if (e.key === 'ArrowRight') { changeDay(1); e.preventDefault(); }
});
</script>

</body>
</html>
