<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <title>Meta-sprint Gateway</title>
  <style>
    :root {
      --bg: #0f172a;
      --card-bg: #1e293b;
      --accent: #38bdf8;
      --accent-hover: #7dd3fc;
      --text: #e2e8f0;
      --text-muted: #94a3b8;
      --border: #334155;
      --green: #4ade80;
      --amber: #fbbf24;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'IBM Plex Sans', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      text-align: center;
      padding: 3rem 1rem 2rem;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      font-size: 2.2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, var(--accent), var(--green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    header p {
      color: var(--text-muted);
      font-size: 1.1rem;
      max-width: 640px;
      margin: 0 auto;
    }

    .stats {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .stat { text-align: center; }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .notice {
      margin-top: 0.75rem;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .search-bar {
      max-width: 520px;
      margin: 2rem auto 0;
      position: relative;
    }

    .search-bar input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.5rem;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      color: var(--text);
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-bar input:focus {
      border-color: var(--accent);
    }

    .search-bar::before {
      content: "\1F50D";
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
    }

    .filter-tabs {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin: 1.5rem auto;
      flex-wrap: wrap;
      max-width: 900px;
      padding: 0 1rem;
    }

    .filter-tab {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }

    .filter-tab:hover,
    .filter-tab.active {
      background: var(--accent);
      color: var(--bg);
      border-color: var(--accent);
    }

    .filter-tab:focus-visible,
    .course-card:focus-visible,
    .search-bar input:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .section-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 2rem 0 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
      color: var(--accent);
    }

    .section-hint {
      margin: -0.5rem 0 1rem;
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1rem;
    }

    .course-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1.25rem;
      transition: all 0.25s;
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .course-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(56, 189, 248, 0.15);
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
    }

    .course-card .title {
      font-size: 1.05rem;
      font-weight: 600;
      color: var(--text);
      line-height: 1.3;
    }

    .course-card .file {
      font-size: 0.78rem;
      color: var(--text-muted);
      font-family: "Cascadia Code", "Fira Code", monospace;
    }

    .tag {
      display: inline-block;
      padding: 0.15rem 0.6rem;
      border-radius: 12px;
      font-size: 0.72rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      width: fit-content;
    }

    .tag-html { background: #164e63; color: #67e8f9; }
    .tag-md { background: #4c1d95; color: #c4b5fd; }
    .tag-py { background: #14532d; color: #86efac; }
    .tag-png { background: #78350f; color: #fcd34d; }
    .tag-meta { background: #1e3a5f; color: #93c5fd; }
    .tag-primary { background: #0c4a6e; color: #e0f2fe; }

    footer {
      text-align: center;
      padding: 2rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      border-top: 1px solid var(--border);
      margin-top: 3rem;
    }

    footer code {
      font-family: "Cascadia Code", "Fira Code", monospace;
      color: var(--accent);
    }

    .hidden { display: none !important; }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .empty-state {
      margin: 2rem auto 0;
      max-width: 700px;
      text-align: center;
      padding: 1.25rem;
      border: 1px dashed var(--border);
      border-radius: 12px;
      color: var(--text-muted);
      background: rgba(30, 41, 59, 0.6);
    }

    .course-card .desc {
      font-size: 0.82rem;
      color: var(--text-muted);
      line-height: 1.4;
    }

    :focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

    @media (max-width: 600px) {
      header h1 { font-size: 1.6rem; }
      .course-grid { grid-template-columns: 1fr; }
    }

    @media print {
      header, .filter-tabs, .search-bar, .empty-state, footer { display: none !important; }
      body { background: white !important; color: black !important; }
      .course-card { break-inside: avoid; box-shadow: none; }
      main { max-width: 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Meta-sprint Gateway</h1>
    <p>Meta-sprint collection with quick access to all HTML pages and supporting files.</p>
    <div class="stats">
      <div class="stat">
        <div class="stat-number" id="total-count">0</div>
        <div class="stat-label">Files</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="html-count">0</div>
        <div class="stat-label">HTML (visible/total)</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="support-count">0</div>
        <div class="stat-label">Supporting (visible/total)</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="visible-count">0</div>
        <div class="stat-label">Visible</div>
      </div>
    </div>
    <p class="notice hidden" id="popup-hint">If links open in a tab, allow pop-ups for this file to force a separate window.</p>
    <div id="live-summary" class="sr-only" aria-live="polite"></div>
    <div class="search-bar">
      <input type="text" id="search" placeholder="Search files..." autocomplete="off" aria-label="Search files">
    </div>
  </header>

  <div class="filter-tabs" role="group" aria-label="Filter files by type">
    <button class="filter-tab active" data-type="all" type="button" aria-pressed="true">All</button>
    <button class="filter-tab" data-type="html" type="button" aria-pressed="false">HTML</button>
    <button class="filter-tab" data-type="md" type="button" aria-pressed="false">MD</button>
    <button class="filter-tab" data-type="png" type="button" aria-pressed="false">PNG</button>
    <button class="filter-tab" data-type="py" type="button" aria-pressed="false">PY</button>
  </div>

  <main id="mainContent">
  </main>

  <div class="empty-state hidden" id="empty-state">No files match your search or filter.</div>

  <footer>Meta-sprint gateway index.html — Run <code>generate_index.ps1</code> to refresh.</footer>

  <script>
    const courses = [
      { file: 'meta-sprint-v3_0-2.html', title: 'Meta-sprint v3.0-2', color: '#2563EB', desc: 'Standard pairwise meta-analysis (RR, OR, MD, SMD)', primary: true },
      { file: 'meta-sprint-nma-v3.html', title: 'Meta-sprint: Network Meta-Analysis', color: '#0891B2', desc: 'Network meta-analysis with CINeMA confidence rating', primary: true },
      { file: 'meta-sprint-dta-v1.html', title: 'Meta-sprint: Diagnostic Test Accuracy', color: '#D97706', desc: 'Diagnostic test accuracy with QUADAS-2 and HSROC' },
      { file: 'meta-sprint-surv-v1.html', title: 'Meta-sprint: Survival', color: '#0284C7', desc: 'Time-to-event / survival analysis (HR, KM)' },
      { file: 'meta-sprint-dose-v1.html', title: 'Meta-sprint: Dose', color: '#EA580C', desc: 'Dose-response relationship modeling' },
      { file: 'meta-sprint-ipd-v1.html', title: 'Meta-sprint: IPD', color: '#7C3AED', desc: 'Individual patient data meta-analysis' },
      { file: 'meta-sprint-prev-v1.html', title: 'Meta-sprint: Prevalence', color: '#E11D48', desc: 'Prevalence and proportion estimation' },
      { file: 'meta-sprint-prog-v1.html', title: 'Meta-sprint: Prognostic Reviews', color: '#0D9488', desc: 'Prognostic factor studies with QUIPS' },
      { file: 'meta-sprint-animal-v1.html', title: 'Meta-sprint: Animal', color: '#059669', desc: 'Preclinical / animal study synthesis' },
      { file: 'meta-sprint-rapid-v1.html', title: 'Meta-sprint: Rapid Reviews', color: '#DC2626', desc: 'Rapid review with streamlined workflow' },
      { file: 'meta-sprint-hta-v1.html', title: 'Meta-sprint: Health Technology Assessment', color: '#4F46E5', desc: 'Health technology assessment framework' },
      { file: 'meta-sprint-umbrella-v1.html', title: 'Meta-sprint: Umbrella Reviews', color: '#6366F1', desc: 'Umbrella review of systematic reviews' },
      { file: 'meta-sprint-qes-v1.html', title: 'Meta-sprint: Qualitative Evidence Synthesis', color: '#C026D3', desc: 'Qualitative evidence synthesis (GRADE-CERQual)' },
      { file: 'meta-sprint-living-v1.html', title: 'Meta-sprint: Living Reviews', color: '#10B981', desc: 'Living systematic review with update triggers' }
    ];

    const supportFiles = [
      { file: 'compare_methods.py', title: 'Compare Methods', type: 'py' },
      { file: 'debug_test.py', title: 'Debug Test', type: 'py' },
      { file: 'MAJOR_IMPROVEMENTS.md', title: 'Major Improvements', type: 'md' },
      { file: 'metasprint_comparison.png', title: 'Meta-sprint Comparison', type: 'png' },
      { file: 'spec_compliance_check.md', title: 'Spec Compliance Check', type: 'md' },
      { file: 'test_metasprint.py', title: 'Meta-sprint Tests', type: 'py' }
    ];

    function escapeHtml(str) {
      return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function buildCards() {
      var main = document.getElementById('mainContent');
      var htmlSection = '<section data-section><h2 class="section-title">Meta-sprint HTML Pages</h2><p class="section-hint">Primary = main workflows.</p><div class="course-grid" data-grid>';
      courses.forEach(function(c) {
        var tags = '<span class="tag tag-html">HTML</span><span class="tag tag-meta" style="background:' + c.color + '22;color:' + c.color + '">Meta-sprint</span>';
        if (c.primary) tags += '<span class="tag tag-primary">Primary</span>';
        htmlSection += '<a href="' + escapeHtml(c.file) + '" class="course-card" data-type="html" data-name="' + escapeHtml(c.file) + '" target="_blank" rel="noopener" style="border-left:4px solid ' + c.color + '">' +
          '<div class="tag-row">' + tags + '</div>' +
          '<span class="title">' + escapeHtml(c.title) + '</span>' +
          '<span class="desc">' + escapeHtml(c.desc) + '</span>' +
          '<span class="file">' + escapeHtml(c.file) + '</span></a>';
      });
      htmlSection += '</div></section>';

      var supSection = '<section data-section><h2 class="section-title">Supporting Files</h2><div class="course-grid" data-grid>';
      supportFiles.forEach(function(s) {
        supSection += '<a href="' + escapeHtml(s.file) + '" class="course-card" data-type="' + s.type + '" data-name="' + escapeHtml(s.file) + '" target="_blank" rel="noopener">' +
          '<div class="tag-row"><span class="tag tag-' + s.type + '">' + s.type.toUpperCase() + '</span></div>' +
          '<span class="title">' + escapeHtml(s.title) + '</span>' +
          '<span class="file">' + escapeHtml(s.file) + '</span></a>';
      });
      supSection += '</div></section>';

      main.innerHTML = htmlSection + supSection;
    }

    buildCards();

    const searchInput = document.getElementById('search');
    const tabs = document.querySelectorAll('.filter-tab');
    const emptyState = document.getElementById('empty-state');
    const liveSummary = document.getElementById('live-summary');
    const popupHint = document.getElementById('popup-hint');

    const totalCount = document.getElementById('total-count');
    const htmlCount = document.getElementById('html-count');
    const supportCount = document.getElementById('support-count');
    const visibleCount = document.getElementById('visible-count');

    let activeType = 'all';

    function getCards() { return document.querySelectorAll('.course-card'); }
    function getGrids() { return document.querySelectorAll('[data-grid]'); }

    var allCards = getCards();
    var total = allCards.length;
    var totalHtml = document.querySelectorAll('.course-card[data-type="html"]').length;
    var totalSupport = total - totalHtml;
    totalCount.textContent = total;

    function applyFilter() {
      var q = searchInput.value.trim().toLowerCase();
      var visible = 0;
      var visibleHtml = 0;
      var visibleSupport = 0;
      var cards = getCards();

      cards.forEach(function(card) {
        var type = card.dataset.type;
        var text = card.textContent.toLowerCase();
        var typeMatch = activeType === 'all' || type === activeType;
        var queryMatch = q === '' || text.includes(q);
        var show = typeMatch && queryMatch;
        card.classList.toggle('hidden', !show);
        if (show) {
          visible += 1;
          if (type === 'html') {
            visibleHtml += 1;
          } else {
            visibleSupport += 1;
          }
        }
      });

      visibleCount.textContent = visible;
      htmlCount.textContent = visibleHtml + ' / ' + totalHtml;
      supportCount.textContent = visibleSupport + ' / ' + totalSupport;
      liveSummary.textContent = visible + ' results shown. ' + visibleHtml + ' HTML, ' + visibleSupport + ' supporting.';

      getGrids().forEach(function(grid) {
        var gridVisible = grid.querySelectorAll('.course-card:not(.hidden)').length;
        var section = grid.closest('[data-section]');
        if (section) {
          section.classList.toggle('hidden', gridVisible === 0);
        }
      });

      emptyState.classList.toggle('hidden', visible !== 0);
    }

    tabs.forEach(function(tab) {
      tab.addEventListener('click', function() {
        tabs.forEach(function(t) {
          t.classList.remove('active');
          t.setAttribute('aria-pressed', 'false');
        });
        tab.classList.add('active');
        tab.setAttribute('aria-pressed', 'true');
        activeType = tab.dataset.type;
        applyFilter();
      });
    });

    searchInput.addEventListener('input', applyFilter);

    document.addEventListener('click', function(event) {
      var card = event.target.closest('.course-card');
      if (!card) return;
      if (event.defaultPrevented) return;
      if (event.button !== 0 || event.metaKey || event.ctrlKey || event.shiftKey || event.altKey) return;
      var opened = window.open(card.href, '_blank', 'noopener,noreferrer,width=1200,height=800');
      if (opened) {
        event.preventDefault();
      } else if (popupHint) {
        popupHint.classList.remove('hidden');
      }
    });

    applyFilter();
  </script>
</body>
</html>
